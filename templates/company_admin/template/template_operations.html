{% extends "base_company_admin.html" %}
{% load static %}
{% load widget_tweaks %}
{% load rostering_tags %}
{% load company_admin_tags %}
{% block title %}
Create permission set
{% endblock title %}
{% block stylesheets %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');



 /* Styles for non-editable features */
.non-editable-feature {
    position: relative;
    cursor: not-allowed;
}

/* Style for disabled dropdown triggers */
.dropdown-trigger.disabled {
    pointer-events: none;
    opacity: 0.7;
    cursor: not-allowed;
    background-color: #f0f0f0;
    color: #999;
}

/* Prevent dropdown menus from showing in non-editable features */
.non-editable-feature .dropdown-menu-main,
.dropdown-menu-main.disabled-dropdown {
    display: none !important;
}

/* Style for disabled toggles and buttons */
.disabled-toggle,
button.disabled {
    opacity: 0.7;
    pointer-events: none;
}

/* Reduce opacity of all elements in non-editable features for visual cue */
.non-editable-feature .action-div {
    opacity: 0.8;
}

/* Optional: Visual indicator for the non-editable area */
.non-editable-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(240, 240, 240, 0.1);
    pointer-events: none;
    z-index: 1;
}



    .padding-10 {
        padding: 15px;

    }

    .gap-13 {
        gap: 20px;
    }

    

    .input-type-div {
        background-color: #FAFAFA;
        height: 50px;
        width: 100%;
        padding: 10px;
        text-transform: capitalize;
        border: 1px solid #999999;
        border-radius: 5px;

    }

    .input-type-div>input {
        border: none;
        outline: none;
        background-color: transparent;
        background: transparent;
        font-family: Inter;
        font-size: 14px;
        font-weight: 400;
        line-height: 26.63px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }

    .input-type-div>input:focus {
        border: none;
        outline: none;
    }

    .max-500 {
        max-width: 500px;
    }

   

    .on-off-section {
        width: 65px;
        height: 35px;
        display: flex;
        position: relative;
        background: red;
    }

    .on-off-section:focus-within .cross-svg {
        right: 0;
        transition: .2s;
    }

    .cross-svg {

        top: -2px;
        transition: .2s;
        cursor: pointer;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 81px;
        height: 34px;
    }


    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #44CB23;
        /* Initial background for ON */
        transition: .4s;
    }

    .slider:before {
        position: absolute;
        content: "ON";
        /* Initial state is ON */
        height: 26px;
        width: 26px;
        left: 8px;
        bottom: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 16px;
        font-family: Inter, sans-serif;
        font-weight: 700;
        color: white;
        transition: .4s;
        z-index: 20;
    }

    input:checked+.slider:before {
        content: "OFF";
        /* Changes to OFF when checked */
        transform: translateX(28px);

    }

    input:checked+.slider {
        background-color: #ff0000;
        /* Changes background for OFF */
        left: 6px;
        width: 70px;


    }


    .slider.round {
        border-radius: 5px;
    }

    .slider.round::after {
        content: "";
        position: absolute;
        height: 100%;
        width: 34px;
        right: 0;
        background-size: cover;
        transition: .4s;
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHZpZXdCb3g9IjAgMCAzOCAzOCIgcG9zaXRpb249InJlbGF0aXZlIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHg9IjAuNSIgeT0iMC41IiB3aWR0aD0iMzciIGhlaWdodD0iMzciIHJ4PSIzLjUiIGZpbGw9IndoaXRlIi8+PHJlY3QgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIzNyIgaGVpZ2h0PSIzNyIgcng9IjMuNSIgc3Ryb2tlPSIjNDRDQjIzIi8+PHBhdGggZD0iTTEyIDIwTDE1LjUyNjQgMjIuODIxMUMxNi4zNTM3IDIzLjQ4MzAgMTcuNTUzNiAyMy4zODQ4IDE4LjI2MjQgMjIuNTk3M0wyNiAxNCIgc3Ryb2tlPSIjNDRDQjIzIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==');
        /* Initial ON image */
        scale: 1.1;

    }

    input:checked+.slider.round::after {
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHZpZXdCb3g9IjAgMCAzOCAzOCIgcG9zaXRpb249InJlbGF0aXZlIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHg9IjAuNSIgeT0iMC41IiB3aWR0aD0iMzciIGhlaWdodD0iMzciIHJ4PSIzLjUiIGZpbGw9IndoaXRlIi8+PHJlY3QgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIzNyIgaGVpZ2h0PSIzNyIgcng9IjMuNSIgc3Ryb2tlPSIjRDIyMjIyIi8+PHBhdGggZD0iTTI1LjUgMTIuNTAwMUwxMi41IDI1LjUwMDFNIDI1LjUgMjUuNUwxMi41IDEyLjUiIHN0cm9rZT0iI0QyMjIyMiIgc3Ryb2tlLXdpZHRoPSIzLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==');
        /* OFF image when checked */
        transform: translateX(-42px);
        scale: 1.1;
        left: 40px;
        right: auto !important;
        border: 1px solid #ff0000;
        border-radius: 5px;
    }

    input:not(:checked)+.slider.round::after {
        border: 1px solid #44CB23;
        border-radius: 5px;
    }

    .gap-40 {
        gap: 20px;
    }

    #clone-templateid {
        /* display: none; */
        background: #D9D9D9;
    }

    .drop-down-rol-base {
        font-size: 20px;
        font-family: inter;
        font-weight: 500;
        line-height: 24px;
        display: flex;
        gap: 24px;
        height: 50px;

    }

    .input-of-rolebase {
        border: none;
        outline: none;
        background-color: #FAFAFA;
        text-transform: capitalize;

    }

    .input-of-rolebase::placeholder {
        font-family: Inter;
        font-size: 16px;
        font-weight: 400;
        line-height: 24.2px;
        text-align: left;
        color: #B8B6B6;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        text-transform: capitalize;

    }

    .input-of-rolebase:focus {
        outline: none;
        border: none;
    }

    .input-upper-div {
        background-color: #fff;
        border: 1px solid #DEE2E6;
        border-radius: 6px;
        height: 100%;

    }
    .input-innerr-div{
        background-color: #FAFAFA;
        border-radius: 6px;
        border: 1px solid #DEE2E6;

    }
   

    .search-button-template {
        background-color: transparent;
    }

    .searched-info {
        padding: 10px 0px 19px 0px;
    }

    .searched-info :where(.navlink.active) {}

    .nav-tabs .nav-item.show .nav-link,
    .nav-tabs .nav-link.active {
        background: #F1F8FA !important;
        border-left: 4px solid #188AE2 !important;
        border-color: #188AE2 !important;
        border-top: none !important;
        border-right: none !important;
        border-bottom: none !important;
        border-radius: 4px;
    }

   

    .border-0 {
        border: none !important;
    }

    .accordion .card-header:after {
        content: "";
    }

    h4 {
        margin: 0 !important;
    }

    .mb-68 {
        margin-bottom: 50px;
    }

    .ps-0 {
        padding-left: 0 !important;
    }

    .role-base-accodian {
        padding: 5px;
        background: rgba(217, 217, 217, 0.08);
        padding-right: 10px;
    }

    .main-card-content:focus {
        box-shadow: none !important;
        overflow: auto !important;
    }

    .main-card-content {
        overflow: visible !important;
    }

    .accordion.card {
        overflow: visible !important;
    }

   

    .bshadow-none {
        box-shadow: none !important;
    }

    .gap-3 {
        gap: 18px;
        row-gap:10px;
    }

  

    .transsperant {
        background-color: transparent;
    }

    .transsperant:focus {
        border: none !important;
        outline: none !important;
    }

    

    .accodians-inner-dropdowns {
        position: absolute;
        transform: translate3d(-185px, 41px, 0px) !important;
        top: -4px !important;
        left: 0px;
        will-change: transform;
        transition: .1s;
    }

    .accodian-inner-dropdowns:hover {
        background: transparent !important;


    }

    .accodians-inner-dropdowns-toggel {
        border: none;
        background-color: transparent;
    }

    .accodians-inner-dropdowns-toggel:focus {
        border: none !important;
        outline: none !important;

    }

    .first-drop-downotem-icon::after {
        content: "";
        height: 20px;
        width: 20px;
        background-color: white;
        position: absolute;
        border-radius: 0px 0px 20px;
        z-index: -1;
        rotate: 45deg;
        top: -11px;
        right: 22px;
        box-shadow: -1px -1px 1px #0000002b;



    }

    {% comment %} .template-submit-button {
        font-family: Inter;
        font-size: 23px;
        font-weight: 500;
        line-height: 27.84px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

        padding: 10px 41px 10px 41px;

        opacity: 0px;
        background: #D9D9D9;
        border: none !important;


    } {% endcomment %}

    {% comment %} .template-submit-button:focus {
        border: none !important;
    } {% endcomment %}
    
    {% comment %} .template-cancle-button {
        font-family: Inter;
        font-size: 23px;
        font-weight: 500;
        line-height: 27.84px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        background: #FFFFFF;
        border: 3px solid #D9D9D9
    } {% endcomment %}

   



    #clone-templateid {
        background: #FBFBFB;
        border: 1px solid #D9D9D9;
        border-radius: 10px;
    }

    .accodians-inner-dropdowns .dropdown-item {
        padding-top: 10px;
        padding-bottom: 10px;
        font-family: Poppins;
        font-size: 21px;
        font-weight: 400;
        line-height: 31.5px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }

    .gap-2 {
        gap: 16px;
    }

    .naimationdropdownicon {
        height: 8px;
        width: 20px;
        
    }

    .right-side-accodian-heading {
        font-weight: 600;
        line-height: 33.89px;
        text-align: left;
        font-size: 20px !important;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }

   

  

   
    .accodian-inner-dropdowns span{
        text-transform: capitalize;
    }

    .accodians-inner-dropdowns-toggel {
        font-family: Inter;
        font-size: 14px;
        font-weight: 600;
        line-height: 16.8px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }

    .accodians-inner-dropdowns-toggel svg {
        height: 6px;
        width: 12px;
    }

    .manager-admin-emp a:first-child {
        padding: 21px 21px 21px 30px;
        background: #F1F8FA;
        border-left: 4px solid #188AE2
    }

    .manager-admin-emp a {
        font-family: Inter;
        font-size: 18px;
        font-weight: 500;
        line-height: 21.78px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        padding: 21px 21px 21px 30px;
        margin-top: 0 !important;
        color: #000000;
        margin-bottom: 0 !important;
        background-color: white;


    }

    .gap-1 {
        gap: 10px;
    }

    .normal-user a {
        padding: 21px 21px 21px 30px;
        background-color: white;
        font-family: Inter;
        font-size: 18px;
        font-weight: 500;
        line-height: 21.78px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        color: black;

    }

    .normal-user a:last-child {
        border-bottom-right-radius: 10px;
        border-bottom-left-radius: 10px;
    }

    .tem-employ {
        font-family: Inter;
        font-size: 20px;
        font-weight: 700;
        line-height: 24.2px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        padding-left: 10px;

    }

    .collapse-overlap {
        position: absolute;
        background-color: #fbfbfb;
        z-index: 1050;
        width: 100%;
        border: 1px solid #D9D9D9;
        left: 0;
        top: 40px;
        border-bottom-right-radius: 10px;
        border-bottom-left-radius: 10px;
        border-top: 0 !important;

    }

    .bolder-tittle.bolder-tittle {
      
        font-size: 14px;
        font-weight: 600;
        line-height: 21.6px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }

    .select-form-admin {
        border-radius: 10px;
        border: 1px solid #D9D9D9;
        height: 40px;

    }

    /* custom selct */


    .custom_dropdown_wrapper {
        width: 100%;

        position: relative;
        font-family: Inter, sans-serif;
        margin: 10px;
    }

    .custom_dropdown_trigger {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #D9D9D9;
        border-radius: 10px;
        background: #FBFBFB;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        font-weight: 400;
        line-height: 24.2px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        text-transform: capitalize;

    }

    .custom_dropdown_trigger::after {
        content: '';
        width: 8px;
        height: 8px;
        border-right: 2px solid #666;
        border-bottom: 2px solid #666;
        transform: rotate(45deg);
        transition: transform 0.3s ease;
    }

    .custom_dropdown_trigger.active::after {
        transform: rotate(-135deg);
    }

    .custom_dropdown_content {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #FBFBFB;
        border: 1px solid #D9D9D9 !important;
        border-top: none !important;
        border-radius: 0px 0px 10px 10px;
        padding-top: 20px;
        margin-top: 0px;
        display: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }

    .custom_dropdown_content.custom_dropdown_show {
        display: block;
    }

    .custom_dropdown_input_wrapper {
        padding: 8px;
        width: 95%;
        margin-left: auto;
        margin-right: auto;
        border: 1px solid #DEE2E6;
        border-radius: 10px;

    }

    .custom_dropdown_input {
        width: 100%;
        padding: 8px 12px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        background: transparent;
        box-sizing: border-box;
    }

    .custom_dropdown_input:focus {
        outline: none;
        border-color: #188AE2;
    }

    .custom_dropdown_options {

        padding: 10px;
        height: 144px;
        overflow: scroll;
        position: relative;
    }

    .custom_dropdown_group {
        padding: 10px 15px;
        font-weight: 600;
        background-color: #F8F9FA;
        color: #28303F;
        font-size: 14px;
    }

    .custom_dropdown_option {
        padding: 10px;
        cursor: pointer;
        background: white;
        transition: background-color 0.2s ease;
        margin-top: 10px;
        font-family: Inter;
        font-size: 16px;
        font-weight: 500;
        line-height: 21.78px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        display: flex;
        justify-content: space-between;
        align-content: center;
        flex-direction: column;
        gap: 5px;
        text-transform: capitalize;


    }
    p.user-mail {
    color: #444;
    font-family: Poppins;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
}

    .custom_dropdown_option:hover {
        background-color: #F1F8FA;
    }

    .custom_dropdown_trigger.active {
        border-bottom-right-radius: 0 !important;
        border-bottom-left-radius: 0 !important;
        border-bottom: none;

    }

    .already-exsist-template {
        padding: 55px;
        background-color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;

    }

    .already-exsist-template-inner {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 33px;
    }

    .new-clint-template-modal .modal-dialog {
        max-width: 550px !important;
    }

    .allready-exist-heading {
        font-family: Inter;
        font-size: 28px;
        font-weight: 700;
        line-height: 33.89px;
        text-align: center;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        margin-bottom: 0;

    }

    .allready-exist-pera {
        font-family: Inter;
        font-size: 16px;
        font-weight: 400;
        line-height: 19.36px;
        text-align: center;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        margin-top: 16px;
        margin-bottom: 0;
    }

    .close-modal-button {
        border: 3px solid #D9D9D9;
        background: #BEBDBD;
        font-family: Inter;
        font-size: 23px;
        font-weight: 500;
        line-height: 27.84px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        margin-bottom: 0;
        margin-top: 27px;
        transition: .2s;

    }

    .close-modal-button:focus {
        border: 3px solid #D9D9D9 !important;
        outline: none !important;
        scale: 1.1;

    }

    .accodians-inner-dropdowns-main-button.accodians-inner-dropdowns-main-button {
        background-color: white !important;
        padding: 2px !important;
        box-shadow: none !important;
        border: none !important;
        font-family: Inter;
        font-size: 14px;
        font-weight: 600;
        line-height: 16.8px;
        text-align: right;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }

    .accodians-inner-dropdowns-main-button:active:hover {
        background-color: white !important;
    }


    .accodians-inner-dropdowns-main-button:hover {
        background-color: white !important;
        box-shadow: none !important;
        border: none !important;
    }

    .accodians-inner-dropdowns-main-button:active {
        background-color: white !important;
    }

    .accodians-inner-dropdowns-main-button:focus {
        background-color: white !important;
    }

    .dorop-down-inner-content.dorop-down-inner-content {
        border: 1px solid #DEE2E6 !important;
        border-radius: 5px !important;
        transform: none !important;
        top: 35px !important;
        left: auto !important;
        right: 0 !important;
    }

    .dorop-down-inner-content li {
        position: relative;
    }

    .dorop-down-inner-content li a:first-child {
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
    }

    .dorop-down-inner-content li a:first-child:hover .dorop-down-inner-content li:first-child::after {
        background-color: #F1F8FA !important;
    }

    .dorop-down-inner-content li a:last-child {
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
    }

    .dorop-down-inner-content li a {
        position: relative !important;
        z-index: 22 !important;
        background-color: white !important;
        font-family: Poppins !important;
        font-size: 21px !important;
        font-weight: 400 !important;
        line-height: 31.5px !important;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;



    }

    .dorop-down-inner-content li a:hover {
        background-color: #F1F8FA !important;
    }

    .dorop-down-inner-content li:first-child::after {
        height: 20px;
        width: 20px;
        position: absolute;
        top: -10px;
        content: '';
        background-color: white;
        rotate: 45deg;
        right: 30px;
        border-radius: 0 0 147% 0;
        z-index: -1;
        border: 1px solid #DEE2E6 !important;

    }

    .access_level {
        border: none !important;
        position: relative;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 140px;
    }

    .access_level option:hover {}

    .switch-button-input:focus+.slider {
        box-shadow: none !important;
    }

    @media (min-width:992px) and (max-width:1164px) {
        .switch {
            width: 94px !important;
        }
    }

  
    /* .template-active {
        border-left: 4px solid #188AE2;
        background: #F1F8FA;
        border-radius: 5px;
    } */
    .dropdown-trigger {
        cursor: pointer;
        display: flex;
        align-items: center;
    }

 

    .dropdown-arrow {
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="21" height="11" viewBox="0 0 21 11" fill="none"><path d="M1.75 2.05469L10.5 9.05469L19.25 2.05469" stroke="%2328303F" stroke-width="2.625" stroke-linecap="round" stroke-linejoin="round"/></svg>');
        width: 10px;
        height: 4px;
        display: flex;
        background-size: contain;
        background-repeat: no-repeat;
        transition: .2s;
        scale: 1.1;
    }

  

    .dropdown-item:first-child {
        position: relative;
        z-index: 222;
       
    }
    .dropdown-item:last-child{
      
    }

   


    .drop-down-menue-inner {
        position: relative;
        z-index: 2222;
        display: flex;
        flex-direction: column;
        gap: 2px;
        background-color: white;
        border-radius: 5px;
        padding-top: 10px;


    }

    .dropdown-item:hover {
        background: #F1F8FA !important;
        cursor: pointer;
    }

    .drop-down-menue-inner::after {
        position: absolute;
        content: "";
        height: 20px;
        width: 19px;
        background-color: rgb(255, 255, 255);
        top: -11px;
        rotate: 45deg;
        z-index: -1;
        left: 80%;
        border: 1px solid #D9D9D9;
        border-right: none;
        border-bottom: none;
    }

  
    .my-0{
        margin-top: 0 !important;
        margin-bottom: 0 !important;
    }
    .gap-55{
        gap: 27px;
    }
    
   
    .pl-66{
        padding-left: 42px;
    }
    .role-base-main-accodian[aria-expanded="true"] .naimationdropdownicon {
        transform: rotate(180deg);
        transition: .2s;
    }
    
    .role-base-main-accodian.collapsed[aria-expanded="true"] .naimationdropdownicon {
        transform: rotate(0deg);
        transition: .2s;
    }





{% comment %} //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////media-quary////////////////////////////////////////////////////// {% endcomment %}

@media (min-width: 769px){
    .created-templated-name {
       
        font-size: 20px !important;
        font-weight: 600;
        line-height: normal;
        text-transform: capitalize;
    }
    .clone-template {
        font-size: 16px !important;
        font-weight: 400;
        line-height: 33px;
        margin: 0 !important;
        width:83%;
    }
    .customfont-tital.customfont-tital {
        font-weight: 400;
        text-align: left;
        font-size:16px !important;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        color: #000000 !important;
        padding: 19px 19px 19px 21px;
        border: none;
        transition: .1s;
        opacity: 0.7;
    }
    .right-side-accodian-heading {
        font-weight: 600;
        line-height: 33.89px;
        text-align: left;
        font-size: 20px !important;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }
    .role-base-main-accodian{
        padding: 30px 0px 30px 20px;
    }
    .our-main-switch{
        margin: 36px 21px 0px 0px;
    }
    .accodin-header-right {
        display: flex;
        gap: 20px;
        align-items: start;
    }
    .collaps-phera {
       
        font-size: 14px !important;
        font-weight: 400;
        line-height: 24px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;



    }
    .create-data {
        font-size: 14px !important;
        font-weight: 400;
        line-height: 19.2px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        margin-top:0 !important;
        margin-bottom:0 !important;


    }
    .create-data strong{
        font-weight: 600 !important;
    }
    .card-body {
        padding-top: 31px;
        padding-bottom: 31px;
    }
    .dropdown-item {
        background-color: white;
        min-width:195px;
        color: #000;
font-family: Poppins;
font-size: 14px !important;
font-style: normal;
font-weight: 400;
line-height: normal;
border-radius: 5px;
    }
    .naimationdropdownicon{
        margin-top:13px;
    }
    .w-90 {
        width: 85% !important;
    }
    .accodian-inner-dropdowns  {

        font-weight: 400;
        line-height: 19.2px !important;
        font-size: 14px !important;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
    }
    .dropdown-text {
        margin-right: 5px;
        color: #263854;
text-align: right;

font-size: 14px;
font-style: normal;
font-weight: 600;
line-height: 120%; /* 16.8px */

    }
    .dropdown-menu-main.dropdown-menu-main {
        border-radius: 7px;
        background: #D9D9D9;
        right: -24px !important;
        top: 35px !important;
        display: none;
        flex-direction: column;
        gap: 5px;
        border: 1px solid #D9D9D9 !important;
        box-shadow: none !important;
        position: absolute;

    }
    .gap-21 {
        gap: 21px;
    }
}


.input-upper-div {
    display: flex;
    flex-direction: column;
     /* or set dynamically */
}

.searched-items {
    flex-grow: 1;
    overflow-y: auto;
}



@media (max-width: 768px) {
    .created-templated-name {
       
        font-size: 20px !important;
        font-weight: 600;
        line-height: normal;
        text-transform: capitalize;
    }
    .clone-template {
        font-size: 14px !important;
        font-weight: 600;
        line-height: 33px;
        margin: 0 !important;
        width:83%;
    }
    .customfont-tital.customfont-tital {
        font-weight: 400;
        text-align: left;
        font-size:16px !important;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        color: #000000 !important;
        padding: 15px 5px;
        border: none;
        transition: .1s;
        opacity: 0.7;
    }
    .right-side-accodian-heading {
        font-weight: 600;
        line-height: 33.89px;
        text-align: left;
        font-size: 16px !important;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }
    .role-base-main-accodian{
        padding:5px 0px 5px 0px;
    }
    .accodin-header-right {
        display: flex;
        gap: 5px;
        align-items: start;
    }
    .our-main-switch{
        margin: 5px 0px 0px 0px;
    }
    .collaps-phera {
       
        font-size: 14px !important;
        font-weight: 400;
        line-height: 24px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;

    }
    .create-data {
        font-size: 14px !important;
        font-weight: 400;
        line-height: 19.2px;
        text-align: left;
        text-underline-position: from-font;
        text-decoration-skip-ink: none;
        margin-top:0 !important;
        margin-bottom:0 !important;


    }
    .bolder-tittle.bolder-tittle{
        font-size:14px;
    }
    .accodian-inner-dropdowns{
        font-size:14px !important;
    }
    .create-data strong{
        font-weight: 600 !important;
    }
    .card-body {
        padding-top: 11px;
        padding-bottom: 11px;
        padding-left:20px;
        padding-right:10px;
    }
    .dropdown-item {
        background-color: white;
        min-width:195px;
        color: #000;
font-family: Poppins;
font-size: 14px !important;
font-style: normal;
font-weight: 400;
line-height: normal;
border-radius: 5px;
padding:5px 10px;
    }
    .padding-10{
        padding:8px;
    }
    .naimationdropdownicon{
        margin-top:14px;
        width:16px;
        height:6px;
    }
    .pl-66{
        padding-left:5px;
    }
    .gap-13{
        gap:5px;
    }
    .our-main-switch{
        position:absolute;
        right:0;
        top:0px;
        scale:0.8;
    }
    .main-switch{
        scale:.9;
        margin-left:14px;
    }
    .dropdown-text {
        margin-right: 5px;
        color: #263854;
text-align: right;

font-size: 11px;
font-style: normal;
font-weight: 600;
line-height: 120%; /* 16.8px */

    }
    .dropdown-menu-main.dropdown-menu-main {
        border-radius: 7px;
        background: #D9D9D9;
        right: -24px !important;
        top: 25px !important;
        display: none;
        flex-direction: column;
        gap: 5px;
        border: 1px solid #D9D9D9 !important;
        box-shadow: none !important;
        position: absolute;

    }
    .action-div {
    margin-top: 16px;
}
.input-upper-div {
    height: 370px !important;
}
.main-card-content {
    padding-bottom: 15px !important;
}
}




#template_name_id ::-ms-input-placeholder {
  color: red;
  opacity: 1; /* Firefox */
}










</style>
{% endblock stylesheets %}
{% block content %} 

<div class="page-bar">
    <div class="page-title-breadcrumb">
        <div class="pull-left">
            {% if request.resolver_match.url_name == 'add_template' or request.resolver_match.url_name == 'clone_template' %}
            <div class="page-title">Add permission set</div>
            {% elif request.resolver_match.url_name == 'edit_template' %}
            <div class="page-title">Edit permission set</div>
            {% else %}
            <div class="page-title">View permission set</div>
            {% endif %}
        </div>
        <ol class="breadcrumb page-breadcrumb pull-right">
            <li><a class="parent-item" href="{% url 'company:template_list' %}">Permission sets list</a>&nbsp;<i class="fa fa-angle-right"></i></li>
            {% if request.resolver_match.url_name == 'add_template' %}
            <li> <a class="text-dark active" href="{% url 'company:add_template' %}">Add permission set</a></li>
            {% elif request.resolver_match.url_name == 'edit_template' %}
            <li> <a class="text-dark active" >Edit permission set</a></li>
            {% elif request.resolver_match.url_name == 'view_template' %}
            <li> <a class="text-dark active" >View permission set</a></li>
            {% endif %}           
        </ol>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        {% if messages %}
        <div class="col-md-12">
            {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        <div class="tabbable-line">
            <ul class="nav customtab nav-tabs" role="tablist">

            </ul>
            <div class="tab-content">
                <div class="tab-pane active fontawesome-demo" id="feature-display">
                    <div id="templateExists" data-exists="{{ request.session.template_exists|yesno:'true,false' }}"
                        data-template-name="{{ request.session.template_name|default:'' }}">
                    </div>
                    <input type="hidden" value="{{existing_template|default:''}}" id="existing_template">
                    <input type="hidden" value="{{actual_existing_template_name|default:''}}" id="actual_existing_template_name">

                    <!-- Modal -->
                    <div class="modal new-clint-template-modal fade " id="exampleModal" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog my-0 d-flex align-items-center justify-content-center h-100"
                            role="document">
                            <div class="modal-content">
                                <div class="already-exsist-template">
                                    <div class="already-exsist-template-inner"><img
                                            src="{% static 'assets/img/allready-exisist.svg' %}" alt="">
                                        <h3 class="allready-exist-heading template-heading mt-0" id ="template-heading"></h3>

                                    </div>
                                    <p class="allready-exist-pera template-paragraph" id="template-paragraph">
                                    </p>
                                    <button class="close-modal-button" id="example-modal-id" data-dismiss="modal">Cancel</button>
                                </div>

                            </div>
                        </div>
                    </div>
                    
                    <div class="modal new-clint-template-modal fade" id="inactivefeaturemodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog my-0 d-flex align-items-center justify-content-center h-100" role="document">
                            <div class="modal-content">
                                <div class="already-exsist-template">
                                    <div class="already-exsist-template-inner">
                                        <img src="{% static 'assets/img/allready-exisist.svg' %}" alt="">
                                        <h3 class="allready-exist-heading mt-0">Template Already Exists</h3>
                                    </div>
                                    <!-- Static message in the modal -->
                                    <p class="modal-message">
                                        Please select at least one active feature to proceed.
                                    </p>
                                    <!-- Cancel button to close the modal -->
                                    <button class="close-modal-button" id="cancelButtonInactiveFeatureModal" type="button">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    


                    <div class="row ">
                        <div class="col-md-12">

                            <div class="card card-box padding-10">
                                <div class="d-flex flex-column gap-13">
                                    {% if user_template_request == 'true' %}
                                    <h2 class="created-templated-name my-0">User Name</h2>
                                    {% endif %}
                                    {% if  user_template_request == 'false' %}
                                    <h2 class="created-templated-name my-0">Permission sets</h2>
                                    {% endif %}
                                    {% if request.resolver_match.url_name == 'add_template' or request.resolver_match.url_name == 'clone_template' %}
                                    <h2 class="created-templated-name my-0">Permission sets</h2>

                                    {% endif %}
                                    <div class="d-flex flex-column ">


                                        <div class="input-type-div  col-lg-5">
                                            {% comment %} <input type="text" name="template_name" id="template_name_id"
                                                class="w-100"> {% endcomment %}
                                            

                                            {% if request.resolver_match.url_name == 'view_template' %}
                                            <input type="hidden"  value="{{user_template_request}}"  id="user_template_request">
                                            <input type="text" placeholder="Permission set name"
                                            value="{% if template_name %}{{ template_name|title }}{% else %}""{% endif %}"
                                            name="template_name"disabled id="template_name_id" class="w-100">
                                            {% else %}
                                            <input type="hidden"  value="{{user_template_request}}"  id="user_template_request">
                                            <input type="text" placeholder="Permission set name"
                                            value="{% if template_name %}{{ template_name|title }}{% else %}""{% endif %}"
                                            name="template_name" {% if user_template_request == 'true' %}readonly{% endif %} id="template_name_id" class="w-100">
                                            {% endif %}
    
                                        </div>
                                
                                        <input type="hidden" value = "{{actual_template_name}}" id="actual_template_name">

                                        <span id="template_is_exist_error"  style="color: red;"></span>
                                 


                                        <div class="mt-2 col-lg-5 mb-2 mt-4 px-0">
                                            
                                            {% if request.resolver_match.url_name == 'add_template' or request.resolver_match.url_name == 'clone_template' %}
                                            <div class=" d-flex align-items-strat justify-content-between align-items-center position-relative">
                                                <h4 class="clone-template">Do you want to clone the permission set?</h4>
    
                                                <!-- <label class="switch main-switch  mb-0">
                                                    <input type="checkbox" class="switch-button-input" id="toggle-checkbox" checked>
                                                    <span class="slider round m-0"></span>
                                                </label> -->
                                                 
                                            
                                                
                                                    
                                                </div>
                                                {% endif %}
        
                                            </div>
                                    </div>
                                    
                                    
                                </div>
                                    
                                <!-- </div> -->
                                {% if request.resolver_match.url_name == 'add_template' or request.resolver_match.url_name == 'clone_template' %}

                                <div class="mt-0 col-lg-5 px-0  mb-4" id="clone-templateid">

                                    <div class="custom_dropdown_wrapper m-0">
                                        <input type="hidden" name="selected_option" id="selected_option_input" value="{{ selected_option }}">
                                        {% if clone_template_name %}
                                        <div class="custom_dropdown_trigger template-active">{{clone_template_name}}</div>
                                        {% else %}
                                        <div class="custom_dropdown_trigger">Select Permission set/user</div>
                                        {% endif %}
                                        <div class="custom_dropdown_content ">
                                            <form class="custom_dropdown_input_wrapper d-flex ">
                                                <input type="text" class="custom_dropdown_input"
                                                    placeholder="Type to search...">
                                                <button type="submit" class="ms-auto border-0 search-button-template">
                                                    <svg width="20" height="20" viewBox="0 0 30 30" fill="none"
                                                        xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M23.45 23.45L28 28M26.7 14.35C26.7 7.52928 21.1707 2 14.35 2C7.52928 2 2 7.52928 2 14.35C2 21.1707 7.52928 26.7 14.35 26.7C21.1707 26.7 26.7 21.1707 26.7 14.35Z"
                                                            stroke="#28303F" stroke-width="2.4375"
                                                            stroke-linecap="round" stroke-linejoin="round" />
                                                    </svg>
                                                </button>
                                            </form>
                                           
                                            <div class="custom_dropdown_group">Permission sets</div>
                                            <div class="custom_dropdown_options">
                                                {% for template in simple_templates %}
                                                    <div class="custom_dropdown_option mt-0{% if clone_template_name == template.group.name|split_string %} template-active{% endif %}" data-value="{{ template.group.id }}" data-type="template">
                                                        {{ template.group.name|split_string }}
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            <div class="custom_dropdown_group">Users</div>
                                            <div class="custom_dropdown_options" style="max-height: 60vh;">
                                                {% comment %} <div class="" style="max-height: 60vh;"> {% endcomment %}

                                                {% for user_template in user_templates %}
                                                
                                                <div class="custom_dropdown_option{% if clone_template_name == user_template.template.group.name|split_string %} template-active{% endif %}" 
                                                    data-value="{{ user_template.template.group.id }}" 
                                                    data-type="user">
                                                    {{ user_template.template.group.name|split_string }}                                                                                          
                                                    {% if user_template.emails %}
                                                        <p class="user-mail m-0">
                                                            {{ user_template.emails|join:", " }}
                                                        </p>
                                                    {% endif %}
                                                </div>
                                                {% endfor %}
                                                {% comment %} </div> {% endcomment %}
                                            </div>
                                        </div>                                            
                                    </div>
                                </div>
                                {% endif %}
                                <div class="row ">
                                    <div class="col-lg-4 ">
                                        <div class="p-3 d-flex flex-column gap-40 input-upper-div h-100">
                                            <div class="">
                                                <form class="mb-0">
                                                    <div class="d-flex flex-column gap-40 input-innerr-div  p-2">
                                                        <div class="p-1 d-flex align-items-center w-100">
                                                            <input placeholder="Search" type="text"
                                                                class="w-100 input-of-rolebase" required>
                                                            <button type="submit"
                                                                class="ms-auto border-0 search-button-template">
                                                                <svg width="20" height="20" viewBox="0 0 30 30"
                                                                    fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                    <path
                                                                        d="M23.45 23.45L28 28M26.7 14.35C26.7 7.52928 21.1707 2 14.35 2C7.52928 2 2 7.52928 2 14.35C2 21.1707 7.52928 26.7 14.35 26.7C21.1707 26.7 26.7 21.1707 26.7 14.35Z"
                                                                        stroke="#28303F" stroke-width="2.4375"
                                                                        stroke-linecap="round"
                                                                        stroke-linejoin="round" />
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <!--side nav for parent category-->
                                            {% include 'company_admin/template/side-nav.html' %}
                                            <!--end -->
                                        </div>
                                    </div>
                                    <div class="col-lg-8 mt-3 mt-lg-0" id='feature-list'>
                                        {% include 'company_admin/template/feature-list.html' %}

                                    </div>
                                </div>
                                <div class="row mt-4">
                                    <div class="col-lg-4"></div>
                                    <div class="col-lg-8">
                                        <div class="d-flex gap-3 ml--2 justify-content-center ">
                                            <form id="template_form" action="{% url 'company:template_feature' %}"
                                                method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" id="final_feature_data_input"
                                                    name="final_feature_data">
                                                <input type="hidden" {% if template_name %} value="{{template_name}}" {% endif %} id="template_name_hidden"
                                                    name="template_name_hidden">
                                                <div class="col-lg-12 p-t-20 text-center">
                                                    {% if request.resolver_match.url_name == 'edit_template' %}
                                                    <input type="hidden" name="template_id" value="{{ template_id }}">
                                                    <button type="submit" class="mdl-button mdl-js-button mdl-button--raised m-b-10 m-r-20 btn-blue template-submit-button">Update</button>
                                                    {% elif request.resolver_match.url_name != 'view_template' %}
                                                    <button type="submit" class="mdl-button mdl-js-button mdl-button--raised m-b-10 m-r-20 btn-blue template-submit-button">Submit</button>
                                                    {% endif %}
                                                    {% if request.GET.user_template_request == "true" %}
                                                    <a href="{% url 'company:users_template_list' %}" class="mdl-button mdl-js-button mdl-button--raised m-b-10 btn-default template-cancle-button" id="cancelBtn">Cancel</a>
                                                    {% else %}   
                                                    <a href="{% url 'company:template_list' %}" class="mdl-button mdl-js-button mdl-button--raised m-b-10 btn-default template-cancle-button" id="cancelBtn">Cancel</a>                      
                                                    {% endif %}
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block javascripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>


<script>
    const currentUrlName = "{{ request.resolver_match.url_name }}";
</script>

<!--Fetching and manupulating permission selection-->

<script>
    class FeatureDataHandler {
        
        constructor() {           
            
            this.defaultFeatureData = {};
            this.finalFeatureData = {};
            this.permissionSets = {}
            this.form = document.getElementById("template_form");
            this.modal = new bootstrap.Modal(document.getElementById('exampleModal'));
            this.modalMessage = document.querySelector('.allready-exist-pera');
            this.modalHeading = document.querySelector('.allready-exist-heading');
            this.existingTemplates = JSON.parse('{{ company_templates_data|safe }}');

            // Load permission sets
            this.loadPermissionSets();
            this.clientProfileActionToggle();
            this.departmentActionToggle();
            this.progressnotesActionToggle();
            this.employeeActionToggle();
            this.termReadActionToggle();
            this.termUpdateActionToggle();
            this.privacyReadActionToggle();
            this.privacyUpdateActionToggle();
            this.userPermissionUpdateActionToggle();
            this.userPermissionUpdateActionDisable();


            // First initialize the data
            this.initializeDefaultFeatureData();
            // Then initialize dropdowns
            this.initializeDropdowns();
            this.attachEventListeners();

            this.handleTemplateNameChange();
            this.updateHiddenInput();

            
        
        }
    
         loadPermissionSets() {
            
            document.querySelectorAll(".permission_sets").forEach((input, index) => {
                try {
                    const formattedValue = input.value.replace(/'/g, '"');
                    const parsedData = JSON.parse(formattedValue);
                    this.permissionSets[index] = parsedData;
                } catch (error) {
                    console.error("Error parsing permission set data:", error);
                    console.error("Invalid JSON input:", input.value);
                }
            });
        
            console.log("Loaded Permission Sets:", this.permissionSets);
        }
        

        initializeDropdowns() {
            document.querySelectorAll('.dropdown-container').forEach(container => {
                const trigger = container.querySelector('.dropdown-trigger');
                
                const menu = container.querySelector('.dropdown-menu-main');
                const text = container.querySelector('.dropdown-text');
                const arrow = container.querySelector('.dropdown-arrow'); 
                const selectedItem = container.querySelector('[data-selected="true"]');
                if (selectedItem) {
                    text.textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }

                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = menu.style.display === 'block';

                    // Close all dropdowns before opening a new one
                    document.querySelectorAll('.dropdown-menu-main').forEach(m => m.style.display = 'none');
                    document.querySelectorAll('.dropdown-arrow').forEach(a => a.style.transform = 'rotate(0deg)');

                    menu.style.display = isOpen ? 'none' : 'block';
                    arrow.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
                    arrow.style.transition = 'transform 0.2s ease';
                });

                container.querySelectorAll('.dropdown-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const actionValue = trigger.getAttribute('value');
                        const dataValue = item.getAttribute('data-value');
                        const parentContainer = item.closest('.main-card-content');
                        const featureKeyInput = parentContainer.querySelector('.feature_name');
                        const feature_key = featureKeyInput ? featureKeyInput.value : null;
                        
                        if (!feature_key) {
                            console.error("Feature key not found for dropdown item.");
                            return;
                        }
                        
                        console.log(` Feature Key: ${feature_key}, Action: ${actionValue}, Data Value: ${dataValue}`);
                        
                        //###################################################################################################################                  
                        //check current recieved action


                        if (actionValue === 'create') {
                            
                            //verify action and data value with permission set
                        
                            const existsInPermissions = Object.values(this.permissionSets).some(permissions =>
                            permissions[actionValue]?.[dataValue] &&
                                Object.keys(permissions[actionValue][dataValue]).some(key => 
                                    Array.isArray(permissions[actionValue][dataValue][key]) &&
                                    permissions[actionValue][dataValue][key].length > 0
                                )
                            );
                            console.log(`Data Value (${dataValue}) Exists with Permissions:`, existsInPermissions);
                            if (existsInPermissions) {
                                //updating current slected value in dropdown
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const createSelectedAccessLevel = document.querySelector(`.${feature_key}-create-selected-access-level`);
                                if (createSelectedAccessLevel) {
                                    createSelectedAccessLevel.textContent = item.textContent;
                                }                                
                                //if exist in json get the nested action keys to update the values

                                const nestedKeys = Object.keys(this.permissionSets)
                                    .flatMap(key => Object.keys(this.permissionSets[key]?.[actionValue]?.[dataValue] || {}));

                                console.log(`Nested Keys inside '${actionValue} > ${dataValue}':`, nestedKeys);
                                
                                  // Check if "update" exists inside the nested keys
                                if (nestedKeys.includes("read")) {
                                    const readTrigger = parentContainer.querySelector(`.${feature_key}-read-trigger`);
                                    if (!readTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentReadValue = readTrigger.getAttribute('data-value'); 
                                
                                    let readArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["create"]?.[dataValue]?.["read"]) {
                                            readArray = permissions["create"][dataValue]["read"];
                                        }
                                    });
                                
                                    // Ensure readArray is an array (fallback to empty array if undefined)
                                    readArray = Array.isArray(readArray) ? readArray : [];
                                    // Check if the current update value exists in the found update array
                                    const isCurrentReadValid = readArray.some(update => update.code === currentReadValue);

                                
                                    //const readText = readTrigger.querySelector('.read-text');
                                    const readText = readTrigger.querySelector(`.${feature_key}-read-text`);

                                
                                    // Get the first update value dynamically from the found permission set
                                    const firstReadOption = readArray.length > 0 ? readArray[0] : null;
                                    const firstReadValue = firstReadOption?.code;
                                    const firstReadText = firstReadOption?.name;
                                
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstReadText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentReadValid && readText && firstReadValue) {
                                        readText.textContent = firstReadText || item.textContent; 
                                        readTrigger.setAttribute('data-value', firstReadValue); 
                                        const readSelectedAccessLevel = document.querySelector(`.${feature_key}-read-selected-access-level`);
                                        if (readSelectedAccessLevel) {
                                            readSelectedAccessLevel.textContent = readText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstReadText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentReadValue} as it's still valid.`);
                                    }
                                }

                                // Check if "update" exists inside the nested keys
                                if (nestedKeys.includes("update")) {
                                    
                                    const updateTrigger = parentContainer.querySelector(`.${feature_key}-update-trigger`);
                                    if (!updateTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentUpdateValue = updateTrigger.getAttribute('data-value'); 
                                
                                    let updateArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["create"]?.[dataValue]?.["update"]) {
                                            updateArray = permissions["create"][dataValue]["update"];
                                        }
                                    });
                                
                                    // Ensure updateArray is an array (fallback to empty array if undefined)
                                    updateArray = Array.isArray(updateArray) ? updateArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentUpdateValid = updateArray.some(update => update.code === currentUpdateValue);

                                
                                    //const updateText = updateTrigger.querySelector('.update-text');
                                    const updateText = updateTrigger.querySelector(`.${feature_key}-update-text`);

                                    // Get the first update value dynamically from the found permission set
                                    const firstUpdateOption = updateArray.length > 0 ? updateArray[0] : null;
                                    const firstUpdateValue = firstUpdateOption?.code;
                                    const firstUpdateText = firstUpdateOption?.name;
                                
                                    console.log(` First Update Value: ${firstUpdateValue}, Text: ${firstUpdateText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentUpdateValid && updateText && firstUpdateValue) {
                                        updateText.textContent = firstUpdateText || item.textContent; 
                                        updateTrigger.setAttribute('data-value', firstUpdateValue); 
                                        const updateSelectedAccessLevel = document.querySelector(`.${feature_key}-update-selected-access-level`);
                                        if (updateSelectedAccessLevel) {
                                            updateSelectedAccessLevel.textContent = updateText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstUpdateText} (${firstUpdateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentUpdateValue} as it's still valid.`);
                                    }
                                }


                                if (nestedKeys.includes("delete")) {
                                    const deletetrigger = parentContainer.querySelector(`.${feature_key}-delete-trigger`);
                                    if (!deletetrigger) return;
                                
                                    // Get the current selected update value
                                    const currentdeleteValue = deletetrigger.getAttribute('data-value'); 
                                
                                    let deleteArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["create"]?.[dataValue]?.["delete"]) {
                                            deleteArray = permissions["create"][dataValue]["delete"];
                                        }
                                    });
                                
                                    // Ensure deleteArray is an array (fallback to empty array if undefined)
                                    deleteArray = Array.isArray(deleteArray) ? deleteArray : [];
                                    
                                    // Check if the current update value exists in the found update array
                                    const isCurrentDeleteisValid = deleteArray.some(update => update.code === currentdeleteValue);

                                
                                    //const readText = deletetrigger.querySelector('.read-text');
                                    const deleteText = deletetrigger.querySelector(`.${feature_key}-delete-text`);

                                
                                    // Get the first update value dynamically from the found permission set
                                    const firstDeleteOption = deleteArray.length > 0 ? deleteArray[0] : null;
                                    const firstReadValue = firstDeleteOption?.code;
                                    const firstDeleteText = firstDeleteOption?.name;
                                
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstDeleteText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentDeleteisValid && deleteText && firstReadValue) {
                                        deleteText.textContent = firstDeleteText || item.textContent; 
                                        deletetrigger.setAttribute('data-value', firstReadValue); 
                                        const deleteSelectedAccessLevel = document.querySelector(`.${feature_key}-delete-selected-access-level`);
                                        if (deleteSelectedAccessLevel) {
                                            deleteSelectedAccessLevel.textContent = deleteText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstDeleteText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentdeleteValue} as it's still valid.`);
                                    }
                                }
                                

                                if (nestedKeys.includes("export")) {
                                    
                                    const exportTrigger = parentContainer.querySelector(`.${feature_key}-export-trigger`);
                                    if (!exportTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentExportValue = exportTrigger.getAttribute('data-value'); 
                                
                                    let exportArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["create"]?.[dataValue]?.["export"]) {
                                            exportArray = permissions["create"][dataValue]["export"];
                                        }
                                    });
                                
                                    // Ensure exportArray is an array (fallback to empty array if undefined)
                                    exportArray = Array.isArray(exportArray) ? exportArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentExportValid = exportArray.some(update => update.code === currentExportValue);

                                
                                    //const updateText = exportTrigger.querySelector('.update-text');
                                    const exportText = exportTrigger.querySelector(`.${feature_key}-export-text`);

                                    // Get the first update value dynamically from the found permission set
                                    const firstExportOption = exportArray.length > 0 ? exportArray[0] : null;
                                    const firstExportValue = firstExportOption?.code;
                                    const firstExportText = firstExportOption?.name;
                                
                                    console.log(` First Update Value: ${firstExportValue}, Text: ${firstExportText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentExportValid && exportText && firstExportValue) {
                                        exportText.textContent = firstExportText || item.textContent; 
                                        exportTrigger.setAttribute('data-value', firstExportValue); 
                                        const exportSelectedAccessLevel = document.querySelector(`.${feature_key}-export-selected-access-level`);
                                        if (exportSelectedAccessLevel) {
                                            exportSelectedAccessLevel.textContent =  exportText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstExportText} (${firstExportValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentExportValue} as it's still valid.`);
                                    }
                                }


                                
                                
                                 
                            } else {
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const SelectedAccessLevel = document.querySelector(`.${feature_key}-selected-access-level`);
                                
                                if (SelectedAccessLevel) {
                                    SelectedAccessLevel.textContent = item.textContent;
                                } 
                                if(dataValue == 'create_templates_none'){
                                    $('#permission_create_text').text('None')

                                }
                                else{
                                    $('#permission_create_text').text('All Users')

                                }
                                
                            }
                        }
                        


                        if (actionValue === 'read') {
                            
                            //verify action and data value with permission set
                        
                            const existsInPermissions = Object.values(this.permissionSets).some(permissions =>
                            permissions[actionValue]?.[dataValue] &&
                                Object.keys(permissions[actionValue][dataValue]).some(key => 
                                    Array.isArray(permissions[actionValue][dataValue][key]) &&
                                    permissions[actionValue][dataValue][key].length > 0
                                )
                            );
                            console.log(`Data Value (${dataValue}) Exists with Permissions:`, existsInPermissions);
                            
                            if (existsInPermissions) {
                                //updating current slected value in dropdown
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const readSelectedAccessLevel = document.querySelector(`.${feature_key}-read-selected-access-level`);
                                if (readSelectedAccessLevel) {
                                    readSelectedAccessLevel.textContent = item.textContent;
                                }                                
                                //if exist in json get the nested action keys to update the values

                                const nestedKeys = Object.keys(this.permissionSets)
                                    .flatMap(key => Object.keys(this.permissionSets[key]?.[actionValue]?.[dataValue] || {}));

                                console.log(`Nested Keys inside '${actionValue} > ${dataValue}':`, nestedKeys);
                                
                                 // Check if "update" exists inside the nested keys
                                 if (nestedKeys.includes("create")) {
                                    const createTrigger = parentContainer.querySelector(`.${feature_key}-create-trigger`);
                                    if (!createTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentCreateValue = createTrigger.getAttribute('data-value'); 
                                
                                    let createArray = [];
                                
                                    // Dynamically find the update array based on the selected create value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["read"]?.[dataValue]?.["create"]) {
                                            createArray = permissions["read"][dataValue]["create"];
                                        }
                                    });
                                
                                    // Ensure createArray is an array (fallback to empty array if undefined)
                                    createArray = Array.isArray(createArray) ? createArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentCreateValue = createArray.some(update => update.code === currentCreateValue);

                                
                                    //const updateText = createTrigger.querySelector('.update-text');
                                    const createText = createTrigger.querySelector(`.${feature_key}-create-text`);

                                    // Get the first update value dynamically from the found permission set
                                    let firstCreateOption = createArray.length > 0 ? createArray[0] : null;
                                    let firstCreateValue = firstCreateOption?.code;
                                    let firstCreateText = firstCreateOption?.name;
                                
                                    console.log(` First Update Value: ${firstCreateValue}, Text: ${firstCreateText}`);
                                    
                                    
                                    if (!isCurrentCreateValue){ 
                                        let updateArray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["read"]?.[dataValue]?.["create"]) {
                                                updateArray = permissions["create"][firstCreateValue]["read"];

                                            }
                                        });
                                        
                                        const result = updateArray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = createArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstCreateValue = matchedRead.code
                                            firstCreateText =  matchedRead.name
                                        }
                                        else{
                                            firstCreateValue = firstCreateValue
                                            firstCreateText = firstCreateText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentCreateValue && createText && firstCreateValue) {
                                        createText.textContent = firstCreateText || item.textContent; 
                                        createTrigger.setAttribute('data-value', firstCreateValue); 
                                        const createSelectedAccessLevel = document.querySelector(`.${feature_key}-create-selected-access-level`);
                                        if (createSelectedAccessLevel) {
                                            createSelectedAccessLevel.textContent = createText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstCreateText} (${firstCreateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentCreateValue} as it's still valid.`);
                                    }
                                }

                                // Check if "update" exists inside the nested keys
                                if (nestedKeys.includes("update")) {
                                    
                                    const updateTrigger = parentContainer.querySelector(`.${feature_key}-update-trigger`);
                                    if (!updateTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentUpdateValue = updateTrigger.getAttribute('data-value'); 
                                
                                    let updateArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["read"]?.[dataValue]?.["update"]) {
                                            updateArray = permissions["read"][dataValue]["update"];
                                        }
                                    });
                                
                                    // Ensure updateArray is an array (fallback to empty array if undefined)
                                    updateArray = Array.isArray(updateArray) ? updateArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentUpdateValid = updateArray.some(update => update.code === currentUpdateValue);

                                
                                    //const updateText = updateTrigger.querySelector('.update-text');
                                    const updateText = updateTrigger.querySelector(`.${feature_key}-update-text`);

                                    // Get the first update value dynamically from the found permission set
                                    const firstUpdateOption = updateArray.length > 0 ? updateArray[0] : null;
                                    const firstUpdateValue = firstUpdateOption?.code;
                                    const firstUpdateText = firstUpdateOption?.name;
                                
                                    console.log(` First Update Value: ${firstUpdateValue}, Text: ${firstUpdateText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentUpdateValid && updateText && firstUpdateValue) {
                                        updateText.textContent = firstUpdateText || item.textContent; 
                                        updateTrigger.setAttribute('data-value', firstUpdateValue); 
                                        const updateSelectedAccessLevel = document.querySelector(`.${feature_key}-update-selected-access-level`);
                                        if (updateSelectedAccessLevel) {
                                            updateSelectedAccessLevel.textContent = updateText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstUpdateText} (${firstUpdateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentUpdateValue} as it's still valid.`);
                                    }
                                }


                                if (nestedKeys.includes("delete")) {
                                    
                                    const deletetrigger = parentContainer.querySelector(`.${feature_key}-delete-trigger`);
                                    if (!deletetrigger) return;
                                
                                    // Get the current selected update value
                                    const currentdeleteValue = deletetrigger.getAttribute('data-value'); 
                                
                                    let deleteArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["read"]?.[dataValue]?.["delete"]) {
                                            deleteArray = permissions["read"][dataValue]["delete"];
                                        }
                                    });
                                
                                    // Ensure deleteArray is an array (fallback to empty array if undefined)
                                    deleteArray = Array.isArray(deleteArray) ? deleteArray : [];
                                    
                                    // Check if the current update value exists in the found update array
                                    const isCurrentDeleteisValid = deleteArray.some(update => update.code === currentdeleteValue);

                                
                                    //const readText = deletetrigger.querySelector('.read-text');
                                    const deleteText = deletetrigger.querySelector(`.${feature_key}-delete-text`);

                                
                                    // Get the first update value dynamically from the found permission set
                                    const firstDeleteOption = deleteArray.length > 0 ? deleteArray[0] : null;
                                    const firstReadValue = firstDeleteOption?.code;
                                    const firstDeleteText = firstDeleteOption?.name;
                                
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstDeleteText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentDeleteisValid && deleteText && firstReadValue) {
                                        deleteText.textContent = firstDeleteText || item.textContent; 
                                        deletetrigger.setAttribute('data-value', firstReadValue); 
                                        const deleteSelectedAccessLevel = document.querySelector(`.${feature_key}-delete-selected-access-level`);
                                        if (deleteSelectedAccessLevel) {
                                            deleteSelectedAccessLevel.textContent = deleteText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstDeleteText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentdeleteValue} as it's still valid.`);
                                    }
                                }
                                

                                if (nestedKeys.includes("export")) {
                                    
                                    const exportTrigger = parentContainer.querySelector(`.${feature_key}-export-trigger`);
                                    if (!exportTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentExportValue = exportTrigger.getAttribute('data-value'); 
                                
                                    let exportArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["read"]?.[dataValue]?.["export"]) {
                                            exportArray = permissions["read"][dataValue]["export"];
                                        }
                                    });
                                
                                    // Ensure exportArray is an array (fallback to empty array if undefined)
                                    exportArray = Array.isArray(exportArray) ? exportArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentExportValid = exportArray.some(update => update.code === currentExportValue);

                                
                                    //const updateText = exportTrigger.querySelector('.update-text');
                                    const exportText = exportTrigger.querySelector(`.${feature_key}-export-text`);

                                    // Get the first update value dynamically from the found permission set
                                    const firstExportOption = exportArray.length > 0 ? exportArray[0] : null;
                                    const firstExportValue = firstExportOption?.code;
                                    const firstExportText = firstExportOption?.name;
                                
                                    console.log(` First Update Value: ${firstExportValue}, Text: ${firstExportText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentExportValid && exportText && firstExportValue) {
                                        exportText.textContent = firstExportText || item.textContent; 
                                        exportTrigger.setAttribute('data-value', firstExportValue); 
                                        const exportSelectedAccessLevel = document.querySelector(`.${feature_key}-export-selected-access-level`);
                                        if (exportSelectedAccessLevel) {
                                            exportSelectedAccessLevel.textContent = exportText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstExportText} (${firstExportValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentExportValue} as it's still valid.`);
                                    }
                                }


                                
                                
                                 
                            } else {
                                
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const SelectedAccessLevel = document.querySelector(`.${feature_key}-selected-access-level`);
                                
                                if (SelectedAccessLevel) {
                                    SelectedAccessLevel.textContent = item.textContent;
                                } 
                                if(dataValue == 'read_templates_none'){
                                    $('#permission_read_text').text('None')

                                }
                                else{
                                    $('#permission_read_text').text('All Users')

                                }

                            }
                        }
                        

                        if (actionValue === 'update') {
                            
                            
                            //verify action and data value with permission set
                        
                            const existsInPermissions = Object.values(this.permissionSets).some(permissions =>
                            permissions[actionValue]?.[dataValue] &&
                                Object.keys(permissions[actionValue][dataValue]).some(key => 
                                    Array.isArray(permissions[actionValue][dataValue][key]) &&
                                    permissions[actionValue][dataValue][key].length > 0
                                )
                            );
                            console.log(`Data Value (${dataValue}) Exists with Permissions:`, existsInPermissions);
                            
                            if (existsInPermissions) {
                                //updating current slected value in dropdown
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                

                                const updateSelectedAccessLevel = document.querySelector(`.${feature_key}-update-selected-access-level`);
                                        if (updateSelectedAccessLevel) {
                                            updateSelectedAccessLevel.textContent = item.textContent;
                                        } 

                                //if exist in json get the nested action keys to update the values

                                const nestedKeys = Object.keys(this.permissionSets)
                                    .flatMap(key => Object.keys(this.permissionSets[key]?.[actionValue]?.[dataValue] || {}));

                                console.log(`Nested Keys inside '${actionValue} > ${dataValue}':`, nestedKeys);
                                
                                // Check if "update" exists inside the nested keys
                                if (nestedKeys.includes("read")) {
                                    
                                    const readTrigger = parentContainer.querySelector(`.${feature_key}-read-trigger`);
                                    if (!readTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentReadValue = readTrigger.getAttribute('data-value'); 
                                
                                    let readArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["update"]?.[dataValue]?.["read"]) {
                                            readArray = permissions["update"][dataValue]["read"];
                                        }
                                    });

                                
                                    
                                    // Ensure readArray is an array (fallback to empty array if undefined)
                                    readArray = Array.isArray(readArray) ? readArray : [];
                                    // Check if the current update value exists in the found update array
                                    const isCurrentReadValid = readArray.some(update => update.code === currentReadValue);

                                
                                    //const readText = readTrigger.querySelector('.read-text');
                                    const readText = readTrigger.querySelector(`.${feature_key}-read-text`);

                                    
                                    // Get the first update value dynamically from the found permission set
                                    let firstReadOption = readArray.length > 0 ? readArray[0] : null;
                                    let firstReadValue = firstReadOption?.code;
                                    let firstReadText = firstReadOption?.name;
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstReadText}`);
                                    
                                     if (!isCurrentReadValid){ 
                                        let updateArray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["update"]?.[dataValue]?.["read"]) {
                                                updateArray = permissions["read"][firstReadValue]["update"];

                                            }
                                        });
                                        
                                        const result = updateArray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = readArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstReadValue = matchedRead.code
                                            firstReadText =  matchedRead.name
                                        }
                                        else{
                                            firstReadValue = firstReadValue
                                            firstReadText = firstReadText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentReadValid && readText && firstReadValue) {
                                        readText.textContent = firstReadText || item.textContent; 
                                        readTrigger.setAttribute('data-value', firstReadValue); 
                                        const readSelectedAccessLevel = document.querySelector(`.${feature_key}-read-selected-access-level`);
                                        if (readSelectedAccessLevel) {
                                            readSelectedAccessLevel.textContent = readText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstReadText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentReadValue} as it's still valid.`);
                                    }
                                }
                               
                                if (nestedKeys.includes("create")) {
                                    const createTrigger = parentContainer.querySelector(`.${feature_key}-create-trigger`);
                                    if (!createTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentCreateValue = createTrigger.getAttribute('data-value'); 
                                
                                    let createArray = [];
                                
                                    // Dynamically find the update array based on the selected create value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["update"]?.[dataValue]?.["create"]) {
                                            createArray = permissions["update"][dataValue]["create"];
                                        }
                                    });
                                
                                    // Ensure createArray is an array (fallback to empty array if undefined)
                                    createArray = Array.isArray(createArray) ? createArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentCreateValue = createArray.some(update => update.code === currentCreateValue);

                                
                                    //const updateText = createTrigger.querySelector('.update-text');
                                    const createText = createTrigger.querySelector(`.${feature_key}-create-text`);

                                    // Get the first update value dynamically from the found permission set
                                    let firstCreateOption = createArray.length > 0 ? createArray[0] : null;
                                    let firstCreateValue = firstCreateOption?.code;
                                    let firstCreateText = firstCreateOption?.name;
                                
                                    console.log(` First Update Value: ${firstCreateValue}, Text: ${firstCreateText}`);
                                    
                                    
                                    if (!isCurrentCreateValue){ 
                                        let updateArray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["update"]?.[dataValue]?.["create"]) {
                                                updateArray = permissions["create"][firstCreateValue]["update"];

                                            }
                                        });
                                        
                                        const result = updateArray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = createArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstCreateValue = matchedRead.code
                                            firstCreateText =  matchedRead.name
                                        }
                                        else{
                                            firstCreateValue = firstCreateValue
                                            firstCreateText = firstCreateText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentCreateValue && createText && firstCreateValue) {
                                        createText.textContent = firstCreateText || item.textContent; 
                                        createTrigger.setAttribute('data-value', firstCreateValue); 
                                        const createSelectedAccessLevel = document.querySelector(`.${feature_key}-create-selected-access-level`);
                                        if (createSelectedAccessLevel) {
                                            createSelectedAccessLevel.textContent = createText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstCreateText} (${firstCreateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentCreateValue} as it's still valid.`);
                                    }
                                }

                                if (nestedKeys.includes("delete")) {
                                    const deletetrigger = parentContainer.querySelector(`.${feature_key}-delete-trigger`);
                                    if (!deletetrigger) return;
                                
                                    // Get the current selected update value
                                    const currentdeleteValue = deletetrigger.getAttribute('data-value'); 
                                
                                    let deleteArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["update"]?.[dataValue]?.["delete"]) {
                                            deleteArray = permissions["update"][dataValue]["delete"];
                                        }
                                    });
                                
                                    // Ensure deleteArray is an array (fallback to empty array if undefined)
                                    deleteArray = Array.isArray(deleteArray) ? deleteArray : [];
                                    
                                    // Check if the current update value exists in the found update array
                                    const isCurrentDeleteisValid = deleteArray.some(update => update.code === currentdeleteValue);

                                
                                    //const readText = deletetrigger.querySelector('.read-text');
                                    const deleteText = deletetrigger.querySelector(`.${feature_key}-delete-text`);

                                
                                    // Get the first update value dynamically from the found permission set
                                    const firstDeleteOption = deleteArray.length > 0 ? deleteArray[0] : null;
                                    const firstReadValue = firstDeleteOption?.code;
                                    const firstDeleteText = firstDeleteOption?.name;
                                
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstDeleteText}`);
                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentDeleteisValid && deleteText && firstReadValue) {
                                        deleteText.textContent = firstDeleteText || item.textContent; 
                                        deletetrigger.setAttribute('data-value', firstReadValue); 
                                        const deleteSelectedAccessLevel = document.querySelector(`.${feature_key}-delete-selected-access-level`);
                                        if (deleteSelectedAccessLevel) {
                                            deleteSelectedAccessLevel.textContent = deleteText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstDeleteText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentdeleteValue} as it's still valid.`);
                                    }
                                }
                                
                                 
                            } else {
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const SelectedAccessLevel = document.querySelector(`.${feature_key}-selected-access-level`);
                                
                                if (SelectedAccessLevel) {
                                    SelectedAccessLevel.textContent = item.textContent;
                                } 
                            }
                        }
                        


                        if (actionValue === 'delete') {
                                
                            //verify action and data value with permission set
                        
                            const existsInPermissions = Object.values(this.permissionSets).some(permissions =>
                            permissions[actionValue]?.[dataValue] &&
                                Object.keys(permissions[actionValue][dataValue]).some(key => 
                                    Array.isArray(permissions[actionValue][dataValue][key]) &&
                                    permissions[actionValue][dataValue][key].length > 0
                                )
                            );
                            console.log(`Data Value (${dataValue}) Exists with Permissions:`, existsInPermissions);
                            
                            if (existsInPermissions) {
                                //updating current slected value in dropdown
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);

                                const deleteSelectedAccessLevel = document.querySelector(`.${feature_key}-delete-selected-access-level`);
                                        if (deleteSelectedAccessLevel) {
                                            deleteSelectedAccessLevel.textContent = item.textContent;
                                        } 

                                //if exist in json get the nested action keys to update the values

                                const nestedKeys = Object.keys(this.permissionSets)
                                    .flatMap(key => Object.keys(this.permissionSets[key]?.[actionValue]?.[dataValue] || {}));

                                console.log(`Nested Keys inside '${actionValue} > ${dataValue}':`, nestedKeys);
                                
                                // Check if "update" exists inside the nested keys

                                if (nestedKeys.includes("create")) {
                                    const createTrigger = parentContainer.querySelector(`.${feature_key}-create-trigger`);
                                    if (!createTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentCreateValue = createTrigger.getAttribute('data-value'); 
                                
                                    let createArray = [];
                                
                                    // Dynamically find the update array based on the selected create value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["delete"]?.[dataValue]?.["create"]) {
                                            createArray = permissions["delete"][dataValue]["create"];
                                        }
                                    });
                                
                                    // Ensure createArray is an array (fallback to empty array if undefined)
                                    createArray = Array.isArray(createArray) ? createArray : [];
                                
                                    // Check if the current update value exists in the found update array
                                    const isCurrentCreateValue = createArray.some(update => update.code === currentCreateValue);

                                
                                    //const updateText = createTrigger.querySelector('.update-text');
                                    const createText = createTrigger.querySelector(`.${feature_key}-create-text`);

                                    // Get the first update value dynamically from the found permission set
                                    let firstCreateOption = createArray.length > 0 ? createArray[0] : null;
                                    let firstCreateValue = firstCreateOption?.code;
                                    let firstCreateText = firstCreateOption?.name;
                                
                                    console.log(` First Update Value: ${firstCreateValue}, Text: ${firstCreateText}`);
                                    
                                    
                                    if (!isCurrentCreateValue){ 
                                        let updateArray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["delete"]?.[dataValue]?.["create"]) {
                                                updateArray = permissions["create"][firstCreateValue]["delete"];

                                            }
                                        });
                                        
                                        const result = updateArray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = createArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstCreateValue = matchedRead.code
                                            firstCreateText =  matchedRead.name
                                        }
                                        else{
                                            firstCreateValue = firstCreateValue
                                            firstCreateText = firstCreateText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentCreateValue && createText && firstCreateValue) {
                                        createText.textContent = firstCreateText || item.textContent; 
                                        createTrigger.setAttribute('data-value', firstCreateValue); 
                                        const createSelectedAccessLevel = document.querySelector(`.${feature_key}-create-selected-access-level`);
                                        if (createSelectedAccessLevel) {
                                            createSelectedAccessLevel.textContent = createText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstCreateText} (${firstCreateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentCreateValue} as it's still valid.`);
                                    }
                                }

                                if (nestedKeys.includes("read")) {
                                    
                                    const readTrigger = parentContainer.querySelector(`.${feature_key}-read-trigger`);
                                    if (!readTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentReadValue = readTrigger.getAttribute('data-value'); 
                                
                                    let readArray = [];
                                    
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["delete"]?.[dataValue]?.["read"]) {
                                            readArray = permissions["delete"][dataValue]["read"];
                                        }
                                    });
                                
                                    // Ensure readArray is an array (fallback to empty array if undefined)
                                    readArray = Array.isArray(readArray) ? readArray : [];
                                    
                                    // Check if the current update value exists in the found update array
                                    
                                    const isCurrentReadValid = readArray.some(update => update.code === currentReadValue);

                                
                                    //const readText = readTrigger.querySelector('.read-text');
                                    const readText = readTrigger.querySelector(`.${feature_key}-read-text`);

                                
                                    // Get the first update value dynamically from the found permission set
                                    let firstReadOption = readArray.length > 0 ? readArray[0] : null;
                                    let firstReadValue = firstReadOption?.code;
                                    let firstReadText = firstReadOption?.name;
                                
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstReadText}`);
                                    
                                    if (!isCurrentReadValid){ 
                                        let updateArray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["delete"]?.[dataValue]?.["read"]) {
                                                updateArray = permissions["read"][firstReadValue]["delete"];

                                            }
                                        });
                                        
                                        const result = updateArray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = readArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstReadValue = matchedRead.code
                                            firstReadText =  matchedRead.name
                                        }
                                        else{
                                            firstReadValue = firstReadValue
                                            firstReadText = firstReadText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 

                                
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentReadValid && readText && firstReadValue) {
                                        readText.textContent = firstReadText || item.textContent; 
                                        readTrigger.setAttribute('data-value', firstReadValue); 
                                        const readSelectedAccessLevel = document.querySelector(`.${feature_key}-read-selected-access-level`);
                                        if (readSelectedAccessLevel) {
                                            readSelectedAccessLevel.textContent = readText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstReadText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentReadValue} as it's still valid.`);
                                    }
                                }
                                                            
                                // Check if "update" exists inside the nested keys
                                if (nestedKeys.includes("update")) {
                                    const updateTrigger = parentContainer.querySelector(`.${feature_key}-update-trigger`);
                                    if (!updateTrigger) return;

                                    // Get the current selected update value
                                    const currentUpdateValue = updateTrigger.getAttribute('data-value'); 

                                    let updateArray = [];

                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["delete"]?.[dataValue]?.["update"]) {
                                            updateArray = permissions["delete"][dataValue]["update"];
                                        }
                                    });

                                    // Ensure updateArray is an array (fallback to empty array if undefined)
                                    updateArray = Array.isArray(updateArray) ? updateArray : [];

                                    // Check if the current update value exists in the found update array
                                    const isCurrentUpdateValid = updateArray.some(update => update.code === currentUpdateValue);


                                    //const updateText = updateTrigger.querySelector('.update-text');
                                    const updateText = updateTrigger.querySelector(`.${feature_key}-update-text`);

                                    // Get the first update value dynamically from the found permission set
                                    let firstUpdateOption = updateArray.length > 0 ? updateArray[0] : null;
                                    let firstUpdateValue = firstUpdateOption?.code;
                                    let firstUpdateText = firstUpdateOption?.name;

                                    console.log(` First Update Value: ${firstUpdateValue}, Text: ${firstUpdateText}`);
                                    

                                    
                                    if (!isCurrentUpdateValid){ 
                                        let updatearray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["delete"]?.[dataValue]?.["update"]) {
                                                updatearray = permissions["update"][firstUpdateValue]["delete"];

                                            }
                                        });
                                        
                                        const result = updatearray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = updateArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstUpdateValue = matchedRead.code
                                            firstUpdateText =  matchedRead.name
                                        }
                                        else{
                                            firstUpdateValue = firstUpdateValue
                                            firstUpdateText = firstUpdateText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    

                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentUpdateValid && updateText && firstUpdateValue) {
                                        updateText.textContent = firstUpdateText || item.textContent; 
                                        updateTrigger.setAttribute('data-value', firstUpdateValue); 
                                        const updateSelectedAccessLevel = document.querySelector(`.${feature_key}-update-selected-access-level`);
                                        if (updateSelectedAccessLevel) {
                                            updateSelectedAccessLevel.textContent = updateText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstUpdateText} (${firstUpdateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentUpdateValue} as it's still valid.`);
                                    }
                                }

                                
                                 
                            } else {
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const SelectedAccessLevel = document.querySelector(`.${feature_key}-selected-access-level`);
                                
                                if (SelectedAccessLevel) {
                                    SelectedAccessLevel.textContent = item.textContent;
                                } 
                            }
                        }
                        

                        if (actionValue === 'export') {
                            
                            //verify action and data value with permission set
                        
                            const existsInPermissions = Object.values(this.permissionSets).some(permissions =>
                            permissions[actionValue]?.[dataValue] &&
                                Object.keys(permissions[actionValue][dataValue]).some(key => 
                                    Array.isArray(permissions[actionValue][dataValue][key]) &&
                                    permissions[actionValue][dataValue][key].length > 0
                                )
                            );
                            console.log(`Data Value (${dataValue}) Exists with Permissions:`, existsInPermissions);
                            
                            if (existsInPermissions) {
                                //updating current slected value in dropdown
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const readSelectedAccessLevel = document.querySelector(`.${feature_key}-export-selected-access-level`);
                                if (readSelectedAccessLevel) {
                                    readSelectedAccessLevel.textContent = item.textContent;
                                }                                
                                //if exist in json get the nested action keys to update the values

                                const nestedKeys = Object.keys(this.permissionSets)
                                    .flatMap(key => Object.keys(this.permissionSets[key]?.[actionValue]?.[dataValue] || {}));

                                console.log(`Nested Keys inside '${actionValue} > ${dataValue}':`, nestedKeys);
                                
                                
                                if (nestedKeys.includes("read")) {
                                    
                                    const readTrigger = parentContainer.querySelector(`.${feature_key}-read-trigger`);
                                    if (!readTrigger) return;
                                
                                    // Get the current selected update value
                                    const currentReadValue = readTrigger.getAttribute('data-value'); 
                                
                                    let readArray = [];
                                
                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["export"]?.[dataValue]?.["read"]) {
                                            readArray = permissions["export"][dataValue]["read"];
                                        }
                                    });
                                
                                    // Ensure readArray is an array (fallback to empty array if undefined)
                                    readArray = Array.isArray(readArray) ? readArray : [];
                                    
                                    // Check if the current update value exists in the found update array
                                    const isCurrentReadValid = readArray.some(update => update.code === currentReadValue);

                                
                                    //const readText = readTrigger.querySelector('.read-text');
                                    const readText = readTrigger.querySelector(`.${feature_key}-read-text`);

                                
                                    // Get the first update value dynamically from the found permission set
                                    let firstReadOption = readArray.length > 0 ? readArray[0] : null;
                                    let firstReadValue = firstReadOption?.code;
                                    let firstReadText = firstReadOption?.name;
                                
                                    console.log(` First Read Value: ${firstReadValue}, Text: ${firstReadText}`);
                                    
                                    if (!isCurrentReadValid){ 
                                        let updateArray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["export"]?.[dataValue]?.["read"]) {
                                                updateArray = permissions["read"][firstReadValue]["export"];

                                            }
                                        });
                                        
                                        const result = updateArray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = readArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstReadValue = matchedRead.code
                                            firstReadText =  matchedRead.name
                                        }
                                        else{
                                            firstReadValue = firstReadValue
                                            firstReadText = firstReadText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentReadValid && readText && firstReadValue) {
                                        readText.textContent = firstReadText || item.textContent; 
                                        readTrigger.setAttribute('data-value', firstReadValue); 
                                        const readSelectedAccessLevel = document.querySelector(`.${feature_key}-read-selected-access-level`);
                                        if (readSelectedAccessLevel) {
                                            readSelectedAccessLevel.textContent = readText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstReadText} (${firstReadValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentReadValue} as it's still valid.`);
                                    }
                                }
                                                            
                                
                                if (nestedKeys.includes("update")) {
                                    const updateTrigger = parentContainer.querySelector(`.${feature_key}-update-trigger`);
                                    if (!updateTrigger) return;

                                    // Get the current selected update value
                                    const currentUpdateValue = updateTrigger.getAttribute('data-value'); 

                                    let updateArray = [];

                                    // Dynamically find the update array based on the selected read value
                                    Object.values(this.permissionSets).forEach(permissions => {
                                        if (permissions?.["export"]?.[dataValue]?.["update"]) {
                                            updateArray = permissions["export"][dataValue]["update"];
                                        }
                                    });

                                    // Ensure updateArray is an array (fallback to empty array if undefined)
                                    updateArray = Array.isArray(updateArray) ? updateArray : [];

                                    // Check if the current update value exists in the found update array
                                    const isCurrentUpdateValid = updateArray.some(update => update.code === currentUpdateValue);


                                    //const updateText = updateTrigger.querySelector('.update-text');
                                    const updateText = updateTrigger.querySelector(`.${feature_key}-update-text`);

                                    // Get the first update value dynamically from the found permission set
                                    let firstUpdateOption = updateArray.length > 0 ? updateArray[0] : null;
                                    let firstUpdateValue = firstUpdateOption?.code;
                                    let firstUpdateText = firstUpdateOption?.name;

                                    console.log(` First Update Value: ${firstUpdateValue}, Text: ${firstUpdateText}`);
                                    
                                    
                                    if (!isCurrentUpdateValid){ 
                                        let Uarray = [];
                                        Object.values(this.permissionSets).forEach(permissions => {
                                            if (permissions?.["export"]?.[dataValue]?.["update"]) {
                                                Uarray = permissions["update"][firstUpdateValue]["export"];

                                            }
                                        });
                                        
                                        const result = Uarray.find(item => item.code === dataValue)
                                        const dataValueAccessLevel = result.access_level
                                        const matchedRead = updateArray.find(item => item.access_level === dataValueAccessLevel);
                                        if (matchedRead){
                                            console.log(matchedRead.code, matchedRead.name)
                                            firstUpdateValue = matchedRead.code
                                            firstUpdateText =  matchedRead.name
                                        }
                                        else{
                                            firstUpdateValue = firstUpdateValue
                                            firstUpdateText = firstUpdateText
                                            console.log('No matching access_level in readArray');

                                        }
                                    } 
                                    

                                    // Update the update dropdown only if the current update value is invalid
                                    if (!isCurrentUpdateValid && updateText && firstUpdateValue) {
                                        updateText.textContent = firstUpdateText || item.textContent; 
                                        updateTrigger.setAttribute('data-value', firstUpdateValue); 
                                        const updateSelectedAccessLevel = document.querySelector(`.${feature_key}-update-selected-access-level`);
                                        if (updateSelectedAccessLevel) {
                                            updateSelectedAccessLevel.textContent = updateText.textContent;
                                        } 
                                        console.log(` Update changed to: ${firstUpdateText} (${firstUpdateValue})`);
                                    } else {
                                        console.log(` Keeping current update value: ${currentUpdateValue} as it's still valid.`);
                                    }
                                }



                                
                                
                                 
                            } else {
                                
                                text.textContent = item.textContent;
                                trigger.setAttribute('data-value', dataValue);
                                const SelectedAccessLevel = document.querySelector(`.${feature_key}-selected-access-level`);
                                
                                if (SelectedAccessLevel) {
                                    SelectedAccessLevel.textContent = item.textContent;
                                } 
                                
                            }
                        }
                        

                        //#######################################################################################################################

                        
                        menu.style.display = 'none';
                        arrow.style.transform = 'rotate(0deg)';
                        this.updateFinalFeatureData();
                    });
                });
            });

            document.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-menu-main').forEach(menu => menu.style.display = 'none');
                document.querySelectorAll('.dropdown-arrow').forEach(arrow => arrow.style.transform = 'rotate(0deg)');
            });
        }

        initializeDefaultFeatureData() {
            
            const allFeatureKeys = new Set();
            document.querySelectorAll(".main-card-content .feature_name").forEach(input => {
                if (input.value) {
                    allFeatureKeys.add(input.value);
                }
            });

            allFeatureKeys.forEach(featureKey => {
                this.defaultFeatureData[featureKey] = [];
                this.finalFeatureData[featureKey] = [];
            });

            document.querySelectorAll(".main-card-content").forEach((card) => {
                const featureKey = card.querySelector(".feature_name")?.value;
                if (!featureKey) return;

                const checkbox = card.querySelector(".our-main-switch input");
                const isActive = checkbox ? !checkbox.checked : true;

                const actions = [];
                card.querySelectorAll(".action-div").forEach((actionContainer) => {
                    const actionName = actionContainer.querySelector(".feature-actions")?.textContent?.trim().replace(":", "");
                    const dropdownTrigger = actionContainer.querySelector(".dropdown-trigger");
                    let accessLevelCode = dropdownTrigger?.getAttribute('data-value');

                    if (!accessLevelCode) {
                        const selectedItem = actionContainer.querySelector('.dropdown-item[data-selected="true"]');
                        accessLevelCode = selectedItem?.getAttribute('data-value');
                    }

                    if (actionName && accessLevelCode) {
                        actions.push({ action: actionName, accessLevelCode, is_active: isActive });
                    }
                });

                if (actions.length > 0) {
                    this.defaultFeatureData[featureKey] = [...actions];
                    this.finalFeatureData[featureKey] = [...actions];
                }
            });

            console.log("Default Feature Data:", this.defaultFeatureData);
            console.log("Initial Final Feature Data:", this.finalFeatureData);
            this.updateHiddenInput();
        }

        updateHiddenInput() {
            const finalFeatureDataInput = document.getElementById("final_feature_data_input");
            
            if (finalFeatureDataInput) {
                finalFeatureDataInput.value = JSON.stringify(this.finalFeatureData);
            }
        }
        


        initializeFeatureData(card) {
            const featureKey = card.querySelector(".feature_name")?.value;
            if (!featureKey) return;
            const checkbox = card.querySelector(".our-main-switch input");
            const isActive = checkbox ? !checkbox.checked : true;
            const actions = [];
            card.querySelectorAll(".action-div").forEach(actionContainer => {
                const action = this.getActionData(actionContainer, isActive);
                if (action) actions.push(action);
            });
            if (actions.length > 0) {
                this.defaultFeatureData[featureKey] = [...actions];
                this.finalFeatureData[featureKey] = [...actions];
            }
        }
    
        getActionData(actionContainer, isActive) {
            const actionName = actionContainer.querySelector(".feature-actions")?.textContent?.trim().replace(":", "");
            const dropdownTrigger = actionContainer.querySelector(".dropdown-trigger");
            let accessLevelCode = dropdownTrigger?.getAttribute('data-value');
            if (!accessLevelCode) {
                const selectedItem = actionContainer.querySelector('.dropdown-item[data-selected="true"]');
                accessLevelCode = selectedItem?.getAttribute('data-value');
            }
            if (actionName && accessLevelCode) {
                return {
                    action: actionName,
                    accessLevelCode: accessLevelCode,
                    is_active: isActive
                };
            }
            return null;
        }

        updateFinalFeatureData() {
            document.querySelectorAll(".main-card-content").forEach(card => {
                const featureKey = card.querySelector(".feature_name")?.value;
                if (!featureKey) return;
                const checkbox = card.querySelector(".our-main-switch input");
                const isActive = checkbox ? !checkbox.checked : true;
                const updatedActions = [];
                card.querySelectorAll(".action-div").forEach(actionContainer => {
                    const action = this.getActionData(actionContainer, isActive);
                    if (action) updatedActions.push(action);
                });
                if (updatedActions.length > 0) {
                    this.finalFeatureData[featureKey] = updatedActions;
                }
            });
            this.updateHiddenInput();
            console.log("Updated Final Feature Data:", this.finalFeatureData);
        }
        

        
        attachEventListeners() {
            if (this.templateNameInput) {
                this.templateNameInput.addEventListener("keyup", () => this.handleTemplateNameChange());
            }

            document.querySelectorAll(".our-main-switch input").forEach((checkbox) => {
                checkbox.addEventListener("change", () => {
                    this.updateFinalFeatureData();
                });
            });

            if (this.form) {
                this.form.addEventListener("submit", (event) => {
                    if (!this.validateForm(event)) {
                        event.preventDefault();
                    }
                });
            }
        }


        clientProfileActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.client_profile-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('client-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'create_all_clients', text: 'All Clients' }
                        : { value: 'create_client_none', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        if (mapping.value === "create_client_none") {
                            dropdownText.textContent = "All Clients";
                            dropdownTrigger.setAttribute('data-value', 'create_all_clients');
                            document.getElementById('client-profile').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            document.getElementById('client-profile').textContent = 'No';
                            dropdownTrigger.setAttribute('data-value', 'create_client_none');
                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
            
            




        }


        departmentActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.department-section-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('department-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'create_department_all', text: 'All Teams' }
                        : { value: 'create_department_team_own', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        if (mapping.value === "create_department_team_own") {
                            dropdownText.textContent = "All Teams";
                            dropdownTrigger.setAttribute('data-value', 'create_department_all');
                            document.getElementById('department_feature').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            document.getElementById('department_feature').textContent = 'No';
                            dropdownTrigger.setAttribute('data-value', 'create_department_team_own');
                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
            
        

            


        }


        progressnotesActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.progress-note-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('progress-note-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'create_progress_notes_own', text: 'All progress notes' }
                        : { value: 'create_progress_notes_no_access', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        if (mapping.value === "create_progress_notes_no_access") {
                            dropdownText.textContent = "All Teams";
                            dropdownTrigger.setAttribute('data-value', 'create_progress_notes_own');
                            document.getElementById('progress-note').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            document.getElementById('progress-note').textContent = 'No';
                            dropdownTrigger.setAttribute('data-value', 'create_progress_notes_no_access');
                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
            
        

            


        }

        employeeActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.employee-approval-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('employee-approval-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'update_employee_approval_all', text: 'All employees' }
                        : { value: 'update_employee_approval_none', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        if (mapping.value === "update_employee_approval_none") {
                            dropdownText.textContent = "All Teams";
                            dropdownTrigger.setAttribute('data-value', 'update_employee_approval_all');
                            document.getElementById('employee-approval').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            document.getElementById('employee-approval').textContent = 'No';
                            dropdownTrigger.setAttribute('data-value', 'update_employee_approval_none');
                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
            
        
        }

        termReadActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.term-read-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('term-read-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'view_terms_and_conditions_all', text: 'All terms and conditions' }
                        : { value: 'view_none_terms_and_conditions', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        
                        if (mapping.value === "view_none_terms_and_conditions") {
                            dropdownText.textContent = "All terms and conditions";
                            dropdownTrigger.setAttribute('data-value', 'view_terms_and_conditions_all');
                            document.getElementById('term-read').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            dropdownTrigger.setAttribute('data-value', 'view_none_terms_and_conditions');
                            document.getElementById('term-read').textContent = 'No';

                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
        
            
            
        
        }


        termUpdateActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.term-update-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('term-update-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'update_terms_and_conditions_all', text: 'All terms and conditions' }
                        : { value: 'update_none_terms_and_conditions', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        
                        if (mapping.value === "update_none_terms_and_conditions") {
                            dropdownText.textContent = "All terms and conditions";
                            dropdownTrigger.setAttribute('data-value', 'update_terms_and_conditions_all');
                            document.getElementById('term-update').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            dropdownTrigger.setAttribute('data-value', 'update_none_terms_and_conditions');
                            document.getElementById('term-update').textContent = 'No';

                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
        
            
            
        
        }

        privacyReadActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.privacy-read-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('privacy-read-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'view_privacy_policy_all', text: 'All privacy policy' }
                        : { value: 'view_none_privacy_policy', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
                    
                    if (targetOption) {
                        
                        if (mapping.value === "view_none_privacy_policy") {
                            dropdownText.textContent = "All terms and conditions";
                            dropdownTrigger.setAttribute('data-value', 'view_privacy_policy_all');
                            document.getElementById('privacy-read').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            dropdownTrigger.setAttribute('data-value', 'view_none_privacy_policy');
                            document.getElementById('privacy-read').textContent = 'No';

                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
        
            
            
        
        }

        privacyUpdateActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.privacy-update-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('privacy-update-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'update_privacy_policy_all', text: 'All privacy policy' }
                        : { value: 'update_none_privacy_policy', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        
                        if (mapping.value === "update_none_privacy_policy") {
                            dropdownText.textContent = "All terms and conditions";
                            dropdownTrigger.setAttribute('data-value', 'update_privacy_policy_all');
                            document.getElementById('privacy-update').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            dropdownTrigger.setAttribute('data-value', 'update_none_privacy_policy');
                            document.getElementById('privacy-update').textContent = 'No';

                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
        
            
            
        
        }

        userPermissionUpdateActionToggle() {
            const dropdownTriggers = document.querySelectorAll('.customize-dropdown-triggerrs');
            dropdownTriggers.forEach(trigger => {
                const container = trigger.closest('.dropdown-container');
                const selectedItem = container.querySelector('.dropdown-item[data-selected="true"]');
                if (selectedItem) {
                    trigger.querySelector('.dropdown-text').textContent = selectedItem.textContent;
                    trigger.setAttribute('data-value', selectedItem.getAttribute('data-value'));
                }
            });
        
            // Handle create action toggles
            const createActionToggles = document.querySelectorAll('.permission-update-action-toggle');
            createActionToggles.forEach(toggle => {
                toggle.addEventListener('change', () => {
                    
                    const dropdownContainer = toggle.closest('.dropdown-container');
                    if (!dropdownContainer) return;
            
                    // Use getElementById() to select dropdownTrigger by ID
                    const dropdownTrigger = document.getElementById('permission-update-toggle-mapping');
                    if (!dropdownTrigger) {
                        console.error('Dropdown trigger not found');
                        return;
                    }
            
                    const dropdownText = dropdownTrigger.querySelector('.dropdown-text');
                    const dropdownItems = dropdownContainer.querySelectorAll('.dropdown-item');
            
                    // Define value mappings
                    const mapping = toggle.checked
                        ? { value: 'update_templates', text: 'All users' }
                        : { value: 'update_templates_none', text: 'None' };
            
                    // Find target dropdown item
                    const targetOption = Array.from(dropdownItems).find(item =>
                        item.getAttribute('data-value') === mapping.value
                    );
            
                    if (targetOption) {
                        
                        if (mapping.value === "update_templates_none") {
                            dropdownText.textContent = "All terms and conditions";
                            dropdownTrigger.setAttribute('data-value', 'update_templates');
                            document.getElementById('permission-update').textContent = 'Yes';
                        } else {
                            dropdownText.textContent = 'None';
                            dropdownTrigger.setAttribute('data-value', 'update_templates_none');
                            document.getElementById('permission-update').textContent = 'No';

                        }
                    }
            
                    // Ensure updateFinalFeatureData is called on toggle change
                    if (typeof this.updateFinalFeatureData === "function") {
                        this.updateFinalFeatureData();
                    }
                });
            
                // Dispatch a change event to ensure the event listener executes initially
                toggle.dispatchEvent(new Event('change'));
            });
        
            
            
        
        }

        userPermissionUpdateActionDisable() {
            if (typeof currentUrlName !== "undefined" && currentUrlName === "view_template") {
                return;
            }
            
            let user_permission_feature_key = 'user_permissions';
            let read_trigger_selector = document.querySelector(`.${user_permission_feature_key}-read-trigger`);
            let update_trigger_selector = document.querySelector(`.${user_permission_feature_key}-update-trigger`);
            let checkbox = document.querySelector('.permission-update-action-toggle');
        
            // Arrow function to ensure the correct 'this' context for updateFinalFeatureData
            const checkAndDisableCheckbox = () => {
                if (read_trigger_selector && !read_trigger_selector.hasAttribute('data-value')) {
                    console.log("Element does not have data-value attribute.");
                    checkbox.disabled = true;
                } else {
                    console.log("Element has data-value attribute:", read_trigger_selector.getAttribute('data-value'));
        
                    let datavalue = read_trigger_selector.getAttribute('data-value');
                    if (datavalue == 'read_templates_none') {
                        
                        checkbox.disabled = true;
                        checkbox.checked = true;
                        update_trigger_selector.setAttribute('data-value', 'update_templates_none');
        
                        // Call updateFinalFeatureData if it's a function
                        if (typeof this.updateFinalFeatureData === "function") {
                            this.updateFinalFeatureData(); // Here 'this' refers to the correct context
                        }
                    } else {
                        checkbox.disabled = false;
                    }
                }
            };
        
            checkAndDisableCheckbox();
        
            // Use arrow function here to ensure 'this' is bound correctly in the event listener
            document.addEventListener("click", (event) => {
                setTimeout(() => {
                    checkAndDisableCheckbox(); // 'this' will be preserved here due to the arrow function
                }, 100);
            });
        }
        
        
   
    }


    
   
    document.addEventListener("DOMContentLoaded", () => new FeatureDataHandler());
   
</script> 

<!--template cloning js-->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dropdownWrapper = document.querySelector('.custom_dropdown_wrapper');
        const dropdownTrigger = document.querySelector('.custom_dropdown_trigger');
        const dropdownContent = document.querySelector('.custom_dropdown_content');
        const searchInput = document.querySelector('.custom_dropdown_input');
        const options = document.querySelectorAll('.custom_dropdown_option');
        const groups = document.querySelectorAll('.custom_dropdown_group');
        const hiddenInput = document.getElementById('selected_option_input');
        dropdownTrigger.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownTrigger.classList.toggle('active');
            dropdownContent.classList.toggle('custom_dropdown_show');
            if (dropdownContent.classList.contains('custom_dropdown_show')) {
                searchInput.focus();
            }
        });
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            let visibleOptionsInGroup = new Map();

            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                const isVisible = text.includes(searchTerm);
                option.style.display = isVisible ? 'block' : 'none';
                let group = option.previousElementSibling;
                while (group && !group.classList.contains('custom_dropdown_group')) {
                    group = group.previousElementSibling;
                }

                if (group) {
                    visibleOptionsInGroup.set(
                        group,
                        (visibleOptionsInGroup.get(group) || 0) + (isVisible ? 1 : 0)
                    );
                }
            });
            groups.forEach(group => {
                group.style.display = visibleOptionsInGroup.get(group) > 0 ? 'block' : 'none';
            });
        });
        options.forEach(option => {
            option.addEventListener('click', () => {
                const selectedValue = option.dataset.value;
                const selectedText = option.textContent;
                options.forEach(opt => {
                    opt.style.borderLeft = 'none';
                    opt.style.backgroundColor = '';
                    opt.style.borderRadius = '';
                });
                dropdownTrigger.textContent = selectedText;
                hiddenInput.value = selectedValue;
                // dropdownTrigger.style.borderLeft = '4px solid #188AE2';
                // dropdownTrigger.style.backgroundColor = '#F1F8FA';
                // dropdownTrigger.style.backgroundColor = '#F1F8FA';
                dropdownTrigger.style.borderRadius = '5px';
                // option.style.borderLeft = '4px solid #188AE2';
                // option.style.backgroundColor = '#F1F8FA';
                option.style.borderRadius = '5px';
                searchInput.value = '';
                dropdownContent.classList.remove('custom_dropdown_show');
                dropdownTrigger.classList.remove('active');
                options.forEach(opt => opt.style.display = 'block');
                groups.forEach(group => group.style.display = 'block');
            });
        });
        document.addEventListener('click', (e) => {
            if (!dropdownWrapper.contains(e.target)) {
                dropdownContent.classList.remove('custom_dropdown_show');
                dropdownTrigger.classList.remove('active');
            }
        });
        searchInput.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                dropdownContent.classList.remove('custom_dropdown_show');
                dropdownTrigger.classList.remove('active');
            }
        });
    });
</script>

{% comment %} <script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".custom_dropdown_option").forEach(function (element) {
            element.addEventListener("click", function () {
                let selectedValue = this.getAttribute("data-value");
                let selectedText = this.textContent.trim();
                let dropdownButton = document.getElementById("dropdownButton");
                let currentUrl = new URL(window.location.origin);

                if (!isNaN(selectedValue)) {
                    currentUrl.pathname = `/clone/template/${selectedValue}/`;
                    template_name_value = $('#template_name_id').val()
                
                    window.location.href = currentUrl.toString();


                } else {
                    console.log("Selected User:", selectedText);
                    dropdownButton.textContent = selectedText;
                }
            });
        });
    });
</script> {% endcomment %}


<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".custom_dropdown_option").forEach(function (element) {
            element.addEventListener("click", function () {
                let selectedValue = this.getAttribute("data-value");
                let selectedText = this.textContent.trim();
                let dropdownButton = document.getElementById("dropdownButton");
                let currentUrl = new URL(window.location.origin);
                if (!isNaN(selectedValue)) {
                    currentUrl.pathname = `/clone/template/${selectedValue}/`;
                    
                    let templateNameValue = document.getElementById('template_name_id').value.trim();
                    
                    if (templateNameValue) {
                        currentUrl.searchParams.set("template_name", templateNameValue);
                    }
                    
                    window.location.href = currentUrl.toString();
                } else {
                    console.log("Selected User:", selectedText);
                    dropdownButton.textContent = selectedText;
                }
            });
        });
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkbox = document.getElementById("toggle-checkbox");
        const div = document.getElementById("clone-templateid");
        const currentPath = window.location.pathname;
        if (div && window.location.pathname.startsWith("/company/template/edit")) {
            div.style.display = "none";
            checkbox.checked = false; 
            checkbox.addEventListener("change", function () {
                if (checkbox.checked) {
                    const redirectUrl = window.location.origin + "/company/template/edit"; // Construct full URL
                    window.location.href = redirectUrl; // Redirect
                }
            });
        }
        // Function to toggle visibility
        function toggleDiv() {
            div.style.display = !checkbox.checked ? "block" : "none";
        }

        // Set default state
        toggleDiv();

        // Add event listener
        checkbox.addEventListener("change", toggleDiv);
    });
</script>
<!--/template cloning js-->



<script>
    document.addEventListener("DOMContentLoaded", function () {
        const dropdownSearchInput = document.querySelector(".custom_dropdown_input");
        const dropdownOptions = document.querySelectorAll(".custom_dropdown_option");

        if (dropdownSearchInput) {
            dropdownSearchInput.addEventListener("input", function () {
                const filter = dropdownSearchInput.value.toLowerCase().trim();

                dropdownOptions.forEach(option => {
                    const text = option.textContent.toLowerCase();
                    option.style.display = text.includes(filter) ? "block" : "none";
                });
            });
        }

        const sideNavSearchInput = document.querySelector(".input-of-rolebase");
        const sideNavItems = document.querySelectorAll(".searched-items .nav-item");

        if (sideNavSearchInput) {
            sideNavSearchInput.addEventListener("input", function () {
                const filter = sideNavSearchInput.value.toLowerCase().trim();

                sideNavItems.forEach(item => {
                    const link = item.querySelector(".nav-link");
                    const text = link.textContent.toLowerCase();
                    item.style.display = text.includes(filter) ? "block" : "none";
                });
            });
        }
    });

</script>

<script>
    document.getElementById("template_name_id").addEventListener("keyup", function(event) {
        const inputValue = this.value;
        $('#template_name_hidden').val(inputValue)
       
      });

      
</script>

{% comment %} 
<script>
    // Check if there are any active features in the feature data
function checkActiveFeatures() {
    const featureDataInput = document.getElementById('final_feature_data_input');
    
    if (!featureDataInput || !featureDataInput.value) {
        return false;
    }
    
    try {
        const featureData = JSON.parse(featureDataInput.value);
        
        // Check if any feature has an active item
        for (const category in featureData) {
            if (Array.isArray(featureData[category])) {
                for (const item of featureData[category]) {
                    if (item.is_active === true) {
                        return true; // Return true if at least one feature is active
                    }
                }
            }
        }
        
        return false; // Return false if no active features found
    } catch (error) {
        console.error('Error parsing feature data:', error);
        return false;
    }
}

// Show the modal for no active features
function showNoActiveFeaturesModal() {
    const modal = document.getElementById('exampleModal');
    const headingElement = modal.querySelector('.template-heading');
    const paragraphElement = modal.querySelector('.template-paragraph');
    
    headingElement.textContent = 'No Active Features';
    paragraphElement.textContent = 'Please enable at least one feature to continue.';
    
    // Show modal using Bootstrap API or manual class manipulation
    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
        const modalInstance = new bootstrap.Modal(modal);
        modalInstance.show();
    } else {
        modal.classList.add('show');
        modal.style.display = 'block';
        document.body.classList.add('modal-open');
        
        // Add backdrop if it doesn't exist
        if (!document.querySelector('.modal-backdrop')) {
            const backdrop = document.createElement('div');
            backdrop.classList.add('modal-backdrop', 'fade', 'show');
            document.body.appendChild(backdrop);
        }
    }
}

// Initialize event listeners when DOM content is loaded
document.addEventListener('DOMContentLoaded', function() {
    const templateForm = document.getElementById('template_form');
    
    if (templateForm) {
        // Use event capture to ensure we handle the event first
        templateForm.addEventListener('submit', function(e) {
            // If no active features, prevent form submission and show modal
            if (!checkActiveFeatures()) {
                e.preventDefault();
                e.stopPropagation();
                showNoActiveFeaturesModal();
                return false;
            }
            // If there are active features, form will submit normally
        }, true); // true enables event capture
    }
    
    // Add close functionality for the modal
    const closeButtons = document.querySelectorAll('[data-dismiss="modal"], .modal .close');
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const modal = document.getElementById('exampleModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
            
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
        });
    });
});
</script> {% endcomment %}


<script>
    $(document).ready(function() {
        // Function to check if any features are active
        function checkActiveFeatures() {
            const featureDataInput = document.getElementById('final_feature_data_input');
            
            if (!featureDataInput || !featureDataInput.value) {
                return false;
            }
            
            try {
                const featureData = JSON.parse(featureDataInput.value);
                
                // Check if any feature has an active item
                for (const category in featureData) {
                    if (Array.isArray(featureData[category])) {
                        for (const item of featureData[category]) {
                            if (item.is_active === true) {
                                return true; // Found at least one active feature
                            }
                        }
                    }
                }
                
                return false; // No active features found
            } catch (error) {
                console.error('Error parsing feature data:', error);
                return false;
            }
        }
    
        // Function to manually show modal using core JavaScript
        function showModal(title, message) {
            const modal = document.getElementById('exampleModal');
            const headingElement = modal.querySelector('.template-heading');
            const paragraphElement = modal.querySelector('.template-paragraph');
            
            headingElement.textContent = title;
            paragraphElement.textContent = message;
            
            // Show the modal using core JS
            modal.style.display = 'block';
            modal.classList.add('show');
            
            // Add backdrop if it doesn't exist
            if (!document.querySelector('.modal-backdrop')) {
                const backdrop = document.createElement('div');
                backdrop.classList.add('modal-backdrop', 'fade', 'show');
                document.body.appendChild(backdrop);
            }
            
            document.body.classList.add('modal-open');
        }
    
        // Main form submission handler
        $('#template_form').submit(function(event) {
            event.preventDefault();
            
            // First check if there are any active features
            var submitButton = $('.template-submit-button');
            var originalButtonText = submitButton.text(); // Replace with the actual ID of your submit button
            submitButton.prop('disabled', true).html('<span class="loader"></span>');

            if (!checkActiveFeatures()) {
                showModal('No Active Features', 'Please enable at least one feature to continue.');
                submitButton.prop('disabled', false).text(originalButtonText);
                return false;
            }
            
            const template_name = $('#template_name_id').val(); 
            const existing_template = $('#existing_template').val();
            
            // Get the current URL of the page
            var currentAddress = window.location.href;
            var is_add_request = false;
    
            if (currentAddress.includes('company/template/add')) {
                is_add_request = true;
            } else if (currentAddress.includes('clone/template')) {
                is_add_request = true; 
            }
    
            if (template_name) {
                $.ajax({
                    url: "{% url 'company:template_is_exist' %}", 
                    type: 'POST',
                    data: {
                        'template_name': template_name,
                        'is_add_request': is_add_request,
                        'existing_template': existing_template,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.exists) {
                            showModal('Template with this name already exists', 
                                     'The template you are trying to create already exists with the same name.');
                            submitButton.prop('disabled', false).text(originalButtonText);
                        } else {
                            var finalFeatureData = $('#final_feature_data_input').val(); 
    
                            $.ajax({
                                url: "{% url 'company:template_permissions_is_exist' %}",  
                                type: 'POST',
                                data: {
                                    'final_feature_data': finalFeatureData,
                                    'is_add_request': is_add_request,
                                    'existing_template': existing_template,
                                    'template_name': template_name,
                                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                                },
                                success: function(response) {
                                    if (response.exists) {
                                        showModal('Template Already Exists',
                                               'The template you are trying to create already exists with the same permissions.');
                                        submitButton.prop('disabled', false).text(originalButtonText);

                                    } else {
                                        // Use a form submit that bypasses jQuery
                                        document.getElementById('template_form').removeEventListener('submit', arguments.callee);
                                        document.getElementById('template_form').submit();
                                    }
                                },
                                error: function(xhr, errmsg, err) {
                                    console.error('Error:', errmsg);
                                    alert('Error: ' + errmsg);
                                    submitButton.prop('disabled', false).text(originalButtonText);
                                }
                            });
                        }
                    },
                    error: function(xhr, errmsg, err) {
                        console.error('Error:', errmsg);
                        alert('Error: ' + errmsg);
                        submitButton.prop('disabled', false).text(originalButtonText);
                    }
                });
            } else {
                console.log('Template name not available');
                submitButton.prop('disabled', false).text(originalButtonText);
            }
        });
    
        // Add event listeners for modal close buttons
        const closeButtons = document.querySelectorAll('[data-dismiss="modal"], .modal .close');
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const modal = document.getElementById('exampleModal');
                modal.style.display = 'none';
                modal.classList.remove('show');
                
                // Remove backdrop
                const backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) {
                    backdrop.parentNode.removeChild(backdrop);
                }
                
                document.body.classList.remove('modal-open');
            });
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const templateForm = document.getElementById("template_form");
        
        templateForm.addEventListener("submit", function(event) {
            const templateNameInput = document.getElementById("template_name_hidden");
            
            if (!templateNameInput.value.trim()) {
                event.preventDefault();
                const templateModal = document.getElementById("exampleModal");
                const modalHeading = templateModal.querySelector(".template-heading");
                const modalParagraph = templateModal.querySelector(".template-paragraph");
                
                if (modalHeading) modalHeading.textContent = "Template Name Required";
                if (modalParagraph) modalParagraph.textContent = "Please enter a template name before submitting the form.";
                
                // Show modal using plain JavaScript (no jQuery)
                templateModal.classList.add('show');
                templateModal.style.display = 'block';
            }
        });
        
        // Check if the cancel button exists and then add event listener
        const cancelButton = document.getElementById("example-modal-id");
        const templateModal = document.getElementById("exampleModal");

        // Debugging: Log if the cancel button is found or not
        if (cancelButton) {
            console.log("Cancel button found!");

            cancelButton.addEventListener("click", function(event) {
                console.log("Cancel button clicked!");
                event.preventDefault();
                templateModal.classList.remove('show');
                templateModal.style.display = 'none';
            });
        } else {
            console.error("Cancel button not found!");
        }
    });
</script>





<script>
    //JS to hide and show action header if no value is selected in select options
    document.addEventListener('DOMContentLoaded', function() {
        
        const featureNames = Array.from(document.querySelectorAll('.feature_name')).map(el => el.value);
        const actions = ['create', 'read', 'update', 'delete' ,'export'];
        featureNames.forEach(featureKey => {
            actions.forEach(action => {
                const triggerElement = document.querySelector(`.${featureKey}-${action}-trigger`);
                
                if (!triggerElement) return;
                
                const selectedLevelElement = document.querySelector(`.${featureKey}-${action}-selected-access-level`);
                
                if (!selectedLevelElement) return;
                
                const hasDataValue = triggerElement.hasAttribute('data-value');
                
                if (!hasDataValue) {
                    if (selectedLevelElement.textContent.trim() !== 'N/A') {
                        selectedLevelElement.textContent = 'N/A';
                    }
                } else {
                    if (selectedLevelElement.textContent.trim() === 'N/A') {
                        selectedLevelElement.textContent = '';
                    }
                }
            });
        });
        
        // Also handle the initial dropdown selection to ensure values are properly displayed
        document.querySelectorAll('.dropdown-trigger').forEach(trigger => {
            
            const dropdownItems = trigger.nextElementSibling?.querySelectorAll('.dropdown-item[data-selected="true"]');
            if (dropdownItems && dropdownItems.length > 0) {
                const selectedItem = dropdownItems[0];
                const actionClass = trigger.getAttribute('value');
                const featureKey = trigger.classList[2].split('-')[0]; 
                
                if (actionClass) {
                    const selectedLevelElement = document.querySelector(`.${featureKey}-${actionClass}-selected-access-level`);
                    if (selectedLevelElement && selectedLevelElement.textContent.trim() === 'N/A') {
                        selectedLevelElement.textContent = selectedItem.textContent.trim();
                    }
                }
            }
        });
    });
    
</script>



<script>
  // JavaScript to handle toggle functionality for feature activation/deactivation
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded - Initializing feature toggle functionality');
    
    // Get all main toggle switches on the page
    const mainToggleSwitches = document.querySelectorAll('.disable-div input[type="checkbox"]');
    console.log('Found', mainToggleSwitches.length, 'main toggle switches');
    
    // Function to update UI elements based on editability state
    function updateFeatureEditability(featureCard, makeNonEditable) {
        // Get the collapse div within this feature card
        const collapseDiv = featureCard.querySelector('.collapse');
        
        // More specifically target the header actions div using its exact class combination
        const headerActionsDiv = featureCard.querySelector('.d-flex.gap-3.align-items-center.flex-wrap.mt-1.header-actions');
        
        if (!collapseDiv) {
            console.error('Collapse div not found in feature card:', featureCard);
            return;
        }
        
        if (makeNonEditable) {
            // Add non-editable class to the entire collapse div
            collapseDiv.classList.add('non-editable-feature');
            
            // Disable all interactive elements within the collapse div
            disableAllInteractiveElements(collapseDiv);
            
            // Hide the header actions div when feature is not active
            if (headerActionsDiv) {
                console.log('Hiding header actions div');
                headerActionsDiv.style.display = 'none';
                // Force immediate style application with !important
                headerActionsDiv.setAttribute('style', 'display: none !important');
            } else {
                console.error('Header actions div not found in feature card:', featureCard);
            }
        } else {
            // Remove non-editable class from the collapse div
            collapseDiv.classList.remove('non-editable-feature');
            
            // Enable all interactive elements within the collapse div
            enableAllInteractiveElements(collapseDiv);
            
            // Show the header actions div when feature is active
            if (headerActionsDiv) {
                console.log('Showing header actions div');
                headerActionsDiv.removeAttribute('style');
                headerActionsDiv.style.display = 'flex';
            } else {
                console.error('Header actions div not found in feature card:', featureCard);
            }
        }
    }
    
    // Function to disable all interactive elements within a container
    function disableAllInteractiveElements(container) {
        // Disable dropdown triggers
        container.querySelectorAll('.dropdown-trigger').forEach(element => {
            element.classList.add('disabled');
            element.setAttribute('data-original-click', element.onclick ? element.onclick.toString() : '');
            element.onclick = function(e) { e.preventDefault(); return false; };
        });
        
        // Disable regular buttons
        container.querySelectorAll('button:not(.role-base-main-accodian)').forEach(element => {
            element.classList.add('disabled');
            element.setAttribute('disabled', 'disabled');
        });
        
        // Handle all toggle switches inside the container
        container.querySelectorAll('.switch input[type="checkbox"]').forEach(element => {
            // Store original state if we need to restore it later
            element.setAttribute('data-original-state', element.checked);
            // Disable the toggle
            element.setAttribute('disabled', 'disabled');
            // Add disabled class to the parent switch
            element.closest('.switch').classList.add('disabled-toggle');
        });
        
        // Also target action-toggle checkboxes specifically
        container.querySelectorAll('.client_profile-action-toggle').forEach(element => {
            element.setAttribute('disabled', 'disabled');
            element.closest('.switch').classList.add('disabled-toggle');
        });
        
        // Disable all dropdown menus and prevent them from opening
        container.querySelectorAll('.dropdown-menu-main').forEach(element => {
            element.classList.add('disabled-dropdown');
        });
        
        // Disable any other interactive elements like select, input fields, etc.
        container.querySelectorAll('select, input[type="text"], input[type="number"], textarea').forEach(element => {
            element.setAttribute('disabled', 'disabled');
        });
    }
    
    // Function to enable all interactive elements within a container
    function enableAllInteractiveElements(container) {
        
        // Enable dropdown triggers
        container.querySelectorAll('.dropdown-trigger.disabled').forEach(element => {
            element.classList.remove('disabled');
            if (element.hasAttribute('data-original-click')) {
                // Just remove the attribute - we'll set onclick to null
                element.removeAttribute('data-original-click');
                element.onclick = null;
            }
        });
        
        // Enable regular buttons
        container.querySelectorAll('button.disabled').forEach(element => {
            element.classList.remove('disabled');
            element.removeAttribute('disabled');
        });
        
        // Re-enable all toggle switches inside the container
        //container.querySelectorAll('.switch input[type="checkbox"][disabled]').forEach(element => {
          //  element.removeAttribute('disabled');
            //element.closest('.switch').classList.remove('disabled-toggle');
       // });
     
        // Handle all toggle switches inside the container
        container.querySelectorAll('.switch input[type="checkbox"]').forEach(element => {
        // Store original state if we need to restore it later
            element.setAttribute('data-original-state', element.checked);
            // Disable the toggle
            element.removeAttribute('disabled');
            // Add disabled class to the parent switch
            element.closest('.switch').classList.remove('disabled-toggle');
        });

       
        // Re-enable action-toggle checkboxes specifically
        container.querySelectorAll('.client_profile-action-toggle[disabled]').forEach(element => {
            element.removeAttribute('disabled');
            element.closest('.switch').classList.remove('disabled-toggle');
        });
        
        // Enable all dropdown menus
        container.querySelectorAll('.dropdown-menu-main.disabled-dropdown').forEach(element => {
            element.classList.remove('disabled-dropdown');
        });
        
        // Enable any other interactive elements
        container.querySelectorAll('select[disabled], input[type="text"][disabled], input[type="number"][disabled], textarea[disabled]').forEach(element => {
            element.removeAttribute('disabled');
        });
    }
    
    // Process each toggle switch for initialization
    mainToggleSwitches.forEach(toggle => {
        if (toggle.hasAttribute('disabled')) {
            console.log('Skipping disabled toggle');
            return; // Skip disabled toggles
        }
        
        // Get feature information
        const featureCard = toggle.closest('.main-card-content');
        if (!featureCard) {
            console.error('Feature card not found for toggle:', toggle);
            return;
        }
        
        const featureNameElem = featureCard.querySelector('.feature_name');
        const featureName = featureNameElem ? featureNameElem.value : 'unknown';
        
        console.log(`Processing feature: ${featureName}, Toggle checked: ${toggle.checked}`);
        
        // IMPORTANT: Apply the initial state based on the toggle position
        // When checkbox is checked, feature is NOT active (per your code logic)
        const isActive = !toggle.checked;
        
        // Apply editability state accordingly
        updateFeatureEditability(featureCard, !isActive);
        
        console.log(`Initial setup for ${featureName}: isActive=${isActive}, making ${!isActive ? 'non-editable' : 'editable'}`);
        
        // Add change event listener for future changes
        toggle.addEventListener('change', function() {
            const isNowActive = !this.checked;
            console.log(`Toggle changed for ${featureName}: isActive=${isNowActive}`);
            
            // Update editability accordingly - with timeout to ensure DOM update
            setTimeout(() => {
                updateFeatureEditability(featureCard, !isNowActive);
            }, 10);
        });
    });
    
    console.log('Feature toggle initialization complete');
});
</script>
<script>
    $(document).ready(function(){
        $("#template_name_id").on("mouseleave", function(){
            var templateName = $(this).val().trim();
            let existing_template_name = $('#existing_template').val();
            let actual_template_name = $('#actual_template_name').val(); 
            let actual_existing_template_name = $('#actual_existing_template_name').val(); 
            let submitButton = document.querySelector(".template-submit-button");
            var is_add_request = false;
            var currentAddress = window.location.href;
            if (currentAddress.includes('company/template/add')) {
                is_add_request = true;
            } else if (currentAddress.includes('clone/template')) {
                is_add_request = true; 
            }
            let user_template_request = $('#user_template_request').val(); 
            
            if (!(user_template_request === 'true' || currentAddress.includes('company/template/view'))) {
                $.ajax({
                    url: "{% url 'company:template_is_exist_on_blur' %}",
                    type: "POST",
                    data: {
                        "template_name": templateName,
                        'is_add_request': is_add_request,
                        'existing_template': existing_template_name,
                        'actual_template_name':actual_template_name,
                        'actual_existing_template_name':actual_existing_template_name,
                        "csrfmiddlewaretoken": "{{ csrf_token }}"
                    },
                    success: function(response) {
                        console.log("Form submitted successfully:", response);
                        if (response.exists) { 
                            document.getElementById("template_is_exist_error").textContent = "Template with this name already exists!";
                            submitButton.disabled = true;
                            submitButton.style.opacity = "0.5";
                        } else {
                            document.getElementById("template_is_exist_error").textContent = "";
                            submitButton.disabled = false;
                            submitButton.style.opacity = "1";
                        }
                        
                    },
                    error: function(xhr, status, error) {
                        console.log("Error:", error);
                    }
                });
            }

        });
    });


    function adjustSearchedItemsHeight() {
    const parent = document.querySelector('.input-upper-div');
    const child = document.querySelector('.searched-items');

    if (parent && child) {
        const parentHeight = parent.clientHeight;

        // Optional: subtract header/input height if there's another element inside
        const otherContent = Array.from(parent.children).filter(el => el !== child);
        const otherHeight = otherContent.reduce((acc, el) => acc + el.offsetHeight, 400);

        child.style.height = (parentHeight - otherHeight) + 'px';
    }
}

// Run after DOM load
window.addEventListener('load', adjustSearchedItemsHeight);

</script>
{% endblock javascripts %}
